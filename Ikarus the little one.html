<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>The legend of Ikarus the little one</title>

<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }


#main-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

    body {
        background: #0f172a;
        color: white;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        min-height: 100vh;
        display: flex;
       // justify-content: center;
       // align-items: center;
        user-select: none;
        touch-action: none;
        overscroll-behavior: none;
    }

    #app-container {
        width: 100%;
        max-width: 520px;
        padding: 12px;
    }
#top-bar {
    width: 100%;
    max-width: 520px;
    margin: 16px auto 8px auto;
    text-align: center;
    font-size: 1rem;
    color: white;
}

#top-bar select {
    font-size: 1rem;
    padding: 4px 8px;
    border-radius: 6px;
    border: none;
    background: #1e293b;
    color: white;
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
}

    #game-container {
        position: relative;
        width: 100%;
        aspect-ratio: 1 / 1;
        background: black;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 0 25px rgba(59, 130, 246, 0.6);
    }

    canvas {
        width: 100%;
        height: 100%;
        display: block;
        background: black;
    }

    .overlay {
        position: absolute;
        inset: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2rem;
        font-weight: bold;
        background: rgba(0, 0, 0, 0.6);
        z-index: 10;
        pointer-events: none;
    }

    .hidden {
        display: none;
    }
</style>
</head>

<body>

<body>
  <div id="main-wrapper">
<div id="top-bar">
  <label for="cameraModeSelect">Camera Mode:</label>
  <select id="cameraModeSelect">
    <option value="FOLLOW">Scrolling (Follow)</option>
    <option value="ROOM">Room-based</option>
  </select>

  &nbsp;&nbsp;&nbsp;

  <label for="exitModeSelect">Exit Location:</label>
  <select id="exitModeSelect">
    <option value="RANDOM">Random (Edge)</option>
    <option value="FIXED">Fixed (1,1)</option>
  </select>
</div>


    <div id="app-container">
      <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <!-- Overlays -->
        <div id="message" class="overlay hidden"></div>
        <div id="pause-message" class="overlay hidden"></div>
      </div>
    </div>
  </div>
</body>


<script>


/* =========================================================
   BLOCK 0 — GLOBAL VARIABLE DECLARATIONS (MVP8 SCROLLING WORLD)
   ========================================================= */

let gameRunning = true;

let wallColor = '#1e90ff';
let speedMultiplier = 1.0;
let TILE_SIZE = 0;

let gameMode = 'SCATTER';
let modeTimer = 0;
let frameCounter = 0;

let exitMode = "RANDOM" ; // or "FIXED"

let score = 0;
let lives = 3;

/* ---------------------------------------------------------
   WORLD MAP (MVP8)
   A single continuous labyrinth, e.g. 39×33 tiles.
   Filled later in Block 2.x by buildMegaMap().
--------------------------------------------------------- */
let WORLD = {
    map: [],        // the full stitched labyrinth
    width: 0,       // set after buildMegaMap()
    height: 0
};

/* ---------------------------------------------------------
   CAMERA (MVP8)
   Defines which 13×11 window of the world is visible.
--------------------------------------------------------- */
let CAMERA = {
    row: 0,         // top-left tile of the visible window
    col: 0,
    width: 11,      // visible columns
    height: 13      // visible rows
};

/* ---------------------------------------------------------
   WORLD OFFSET (TABLECLOTH CAMERA, MVP8a)
   --------------------------------------------------------- */
let WORLD_OFFSET_X = 0;   // pixel offset of world
let WORLD_OFFSET_Y = 0;


/* ---------------------------------------------------------
   ENTITIES (GLOBAL COORDINATES)
--------------------------------------------------------- */
let GHOSTS = [];
let GHOST_BEHAVIORS = [];

/* Pac-Man / Ikarus will use:
   entity.worldRow
   entity.worldCol
   entity.x
   entity.y
   (set later in initialization)
*/

/* ---------------------------------------------------------
   GAME STATE
--------------------------------------------------------- */
let deathPhase = 'ALIVE';
let deathTimer = 0;

let touchStartX = null;
let touchStartY = null;
let activeTouch = false;

let transitionFlash = 0;
let isNight = false;

let returningPauseStarted = false;
let returningPauseFrames = 0;

let pacGhostJoinProgress = 0;

let impactEffects = [];

const ARRIVAL_THRESHOLD = 2.5;

/* =========================================================
   SKY ICON (SUN / MOON MARQUEE)
   ========================================================= */

function drawSkyIcon() {
console.log("DRAWING SKY ICON:", skyIcon.sprite);

    if (!skyIcon.active) return;

    ctx.save();

    // Position above the temple frame
    const topOffset = TILE_SIZE * 0.4;
    ctx.translate(skyIcon.x, topOffset);

    const size = TILE_SIZE * 0.5;

    if (skyIcon.sprite === "sun") {
        // APOLLO — FIRE CHARIOT
        ctx.save();

        // Flame wheels
        ctx.fillStyle = "#FFB300";
        ctx.beginPath();
        ctx.arc(-size * 0.6,  size * 0.3, size * 0.25, 0, Math.PI * 2);
        ctx.arc( size * 0.6,  size * 0.3, size * 0.25, 0, Math.PI * 2);
        ctx.fill();

        // Chariot body
        ctx.fillStyle = "#FFD93D";
        ctx.beginPath();
        ctx.ellipse(0, size * 0.1, size * 0.9, size * 0.35, 0, 0, Math.PI * 2);
        ctx.fill();

        // Apollo (simple chibi silhouette)
        ctx.fillStyle = "#FFF7C0";
        ctx.beginPath();
        ctx.arc(0, -size * 0.2, size * 0.22, 0, Math.PI * 2); // head
        ctx.fill();

        ctx.fillRect(-size * 0.12, -size * 0.05, size * 0.24, size * 0.25); // torso

        // Reins
        ctx.strokeStyle = "#FFB300";
        ctx.lineWidth = size * 0.08;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(-size * 0.6, size * 0.3);
        ctx.moveTo(0, 0);
        ctx.lineTo( size * 0.6, size * 0.3);
        ctx.stroke();

        ctx.restore();
    }

    else if (skyIcon.sprite === "moon") {
        // ARTEMIS — GLOWING MOON ARCH
        ctx.save();

        // Crescent bow
        ctx.strokeStyle = "#A0B4FF";
        ctx.lineWidth = size * 0.18;
        ctx.beginPath();
        ctx.arc(0, 0, size * 0.7, -0.6, 0.6);
        ctx.stroke();

        // Glow
        ctx.shadowColor = "#A0B4FF";
        ctx.shadowBlur = size * 0.6;

        // Artemis silhouette
        ctx.fillStyle = "#E0E8FF";
        ctx.beginPath();
        ctx.arc(0, -size * 0.15, size * 0.22, 0, Math.PI * 2); // head
        ctx.fill();

        ctx.fillRect(-size * 0.12, 0, size * 0.24, size * 0.3); // torso

        // Bowstring
        ctx.strokeStyle = "#C8D4FF";
        ctx.lineWidth = size * 0.05;
        ctx.beginPath();
        ctx.moveTo(-size * 0.6, 0);
        ctx.lineTo(size * 0.6, 0);
        ctx.stroke();

        ctx.restore();
    }

    ctx.restore();
}



let skyIcon = {
    active: false,
    x: 0,
    y: TILE_SIZE * 1.2,
    sprite: null,
    duration: 1,
    startTime: 0
};

function lerp(a, b, t) {
    return a + (b - a) * t;
}

/* =========================================================
   NOTE:
   The entire 3×3 room system (WORLD.rooms, loadRoom,
   portalTransition, currentRow/currentCol) has been removed
   for MVP8. The world is now one continuous map, and the
   camera determines what is visible.
   ========================================================= */


/* =========================================================
   End of BLOCK 0 
   ========================================================= */
/* =========================================================
   BLOCK 1 — SCRIPT START
   Canvas + DOM references only (no game logic yet)
   ========================================================= */

window.gameState = 'LOADING';

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

wallColor = '#1e90ff'; // visible blue walls

const messageEl = document.getElementById('message');
const pauseMessage = document.getElementById('pause-message');

// Full-screen swipe coverage (mobile)
const swipeTarget = document.body;

/* =========================================================
   BLOCK 1b — UI DROPDOWN REFERENCES
   ========================================================= */

const cameraModeDropdown = document.getElementById("cameraModeSelect");
const exitModeDropdown   = document.getElementById("exitModeSelect");

window.addEventListener("load", () => {
    const event = new Event("change");
    exitModeDropdown.dispatchEvent(event);
});


/* =========================================================
   End of Block 1
   ========================================================= */


/* =========================================================
   BLOCK 2 — CONSTANTS, GLOBALS, GAME STATE
   ========================================================= */
/* =========================================================
   BLOCK 2.1 — CONSTANTS, GLOBALS, GAME STATE (MVP8)
   ========================================================= */

// --- SPEED TUNING ---
const PACMAN_SPEED = 0.08;
const GHOST_SPEED  = 0.07;
speedMultiplier = 1.0;

// --- TURN BUFFERING ---
const TURN_TOLERANCE = 0.25;

// --- MOBILE DRAG INPUT ---
const SWIPE_ACTIVATION_DISTANCE = 12;

// --- PAUSE ---
const DEATH_PAUSE_MS = 400;

/* ---------------------------------------------------------
   GRID CONFIG (MVP8)
   These describe the *visible window*, not the world size.
   The world size will be set later when we build the mega-map.
--------------------------------------------------------- */
const VIEW_WIDTH  = 11;   // visible columns
const VIEW_HEIGHT = 13;   // visible rows
TILE_SIZE = 0;

// --- GAME STATE ---
window.gameState  = 'PAUSED_START';
gameMode = 'SCATTER';
modeTimer = 0;
frameCounter = 0;

// --- SCORE / LIVES ---
score = 0;
lives = 3;

/* =========================================================
   End of BLOCK 2.1
   ========================================================= */

/* =========================================================
   BLOCK 2.2 — TILE LEGEND & BASE ROOM TEMPLATE (MVP8)
   ========================================================= */

// TILE LEGEND
// 0 = pellet or breadcrumb
// 1 = wall
// 2 = empty floor
// 3 = key
// 4 = exit door
// 5 = crushed breadcrumb
// 6 = doorway / portal   (optional in MVP8 — can be used for shortcuts)

/* ---------------------------------------------------------
   BASE ROOM TEMPLATE (13×11)
   Used to build the full 39×33 world in Block 2.3.
   This is no longer the "active map" — just a template.
--------------------------------------------------------- */
const ROOM_TEMPLATE = [
    [1,1,1,1,1,6,1,1,1,1,1],
    [1,2,2,2,1,2,1,2,2,2,1],
    [1,2,1,2,1,2,1,2,1,2,1],
    [1,2,2,2,2,2,2,2,2,2,1],
    [1,1,1,2,1,1,1,2,1,1,1],
    [6,2,1,2,2,2,1,2,2,2,6],
    [1,2,1,2,1,1,1,2,1,2,1],
    [1,2,2,2,1,2,1,2,2,2,1],
    [1,1,2,1,1,2,1,1,2,1,1],
    [1,2,2,2,2,2,2,2,2,2,1],
    [1,2,1,2,1,2,1,2,1,2,1],
    [1,2,2,2,1,2,1,2,2,2,1],
    [1,1,1,1,1,6,1,1,1,1,1]
];

/* ---------------------------------------------------------
   PASSABILITY CHECK (unchanged)
--------------------------------------------------------- */
function isPassable(tile) {
    return (
        tile === 0 ||   // breadcrumb
        tile === 2 ||   // empty floor
        tile === 3 ||   // key
        tile === 4 ||   // exit
        tile === 5 ||   // crushed breadcrumb
        tile === 6      // portal (optional)
    );
}

/* ---------------------------------------------------------
   NOTE:
   MAP is no longer defined here.
   In MVP8, MAP is replaced by WORLD.map (the full labyrinth),
   which is built in Block 2.3 using ROOM_TEMPLATE.
--------------------------------------------------------- */

/* =========================================================
   End of BLOCK 2.2 (MVP8)
   ========================================================= */

/* =========================================================
   BLOCK 2.3 — ENTITIES (MVP8 SCROLLING WORLD)
   ========================================================= */

/* ---------------------------------------------------------
   IKARUS / PACMAN — GLOBAL COORDINATES
   worldRow/worldCol refer to WORLD.map (full labyrinth)
--------------------------------------------------------- */
const pacman = {
    worldCol: 5,       // starting tile (global)
    worldRow: 11,
    nextCol: 5,
    nextRow: 11,

    x: 0,              // pixel coordinates (computed later)
    y: 0,
    targetX: 0,
    targetY: 0,

    direction: 'UP',
    requestedDirection: 'UP',

    radius: 0,
    moving: true,
    mouthAngle: 0,
    mouthClosing: false,

    isCelebrating: false,
    isGhost: false,

    skin: "#fcd5b5",
    hairColor: "#7b3f00"
};

/* ---------------------------------------------------------
   GHOST DATA — GLOBAL COORDINATES
   Ghosts now roam the entire labyrinth, not rooms.
--------------------------------------------------------- */
const GHOST_COLORS = ['red', 'pink', 'cyan', 'orange'];

/* Starting position in the global world.
   (We will convert this to worldRow/worldCol after the
    mega-map is built in Block 2.3 or resetGame.)
*/
const GHOST_START = { worldCol: 5, worldRow: 3 };

GHOSTS = [];
GHOST_BEHAVIORS = [];

/* ---------------------------------------------------------
   MINOTAUR — GLOBAL STATE MACHINE
--------------------------------------------------------- */
const MINOTAUR_STATES = {
    ROAMING: "ROAMING",
    CHARGING: "CHARGING",
    STUNNED: "STUNNED",
    CHARGING_PREP: "Prepping"
};

/* =========================================================
   End of BLOCK 2.3 (MVP8)
   ========================================================= */


/* =========================================================
    Reordered inside Block 2 - BLOCK 5M 0 — MINI LOGIC (Ghost-style movement)
   ========================================================= */

const MINI = {
    worldCol: 0,
    worldRow: 0,
    nextCol: 0,
    nextRow: 0,
    x: 0,
    y: 0,
    direction: "LEFT",
    moving: true,
    speed: GHOST_SPEED,   // same base speed as ghosts (tune later)
};

// ---------------------------------------------------------
// Initialize Mini at a world position
// ---------------------------------------------------------
function initializeMini(startCol, startRow) {
    MINI.worldCol = startCol;
    MINI.worldRow = startRow;
    MINI.nextCol  = startCol;
    MINI.nextRow  = startRow;

    const { x, y } = getCenterPixel(startCol, startRow);
    MINI.x = x;
    MINI.y = y;

    setNextTarget(MINI, MINI.direction);
}

// ---------------------------------------------------------
// Mini uses RED ghost logic: target Pacman's current tile
// ---------------------------------------------------------
function getMiniDirection() {
    // Red ghost logic: chase Pacman's tile
    const target = { 
        x: pacman.worldCol, 
        y: pacman.worldRow 
    };

    // Reuse your existing ghost direction logic
    return getGhostDirection({
        worldCol: MINI.worldCol,
        worldRow: MINI.worldRow,
        direction: MINI.direction,
        targetFn: () => target
    });
}

// ---------------------------------------------------------
// Breadcrumb crushing (same as Minotaur)
// ---------------------------------------------------------
function miniCrushBreadcrumbs() {
    const centerX = MINI.worldCol * TILE_SIZE + TILE_SIZE / 2;
    const centerY = MINI.worldRow * TILE_SIZE + TILE_SIZE / 2;

    const aligned =
        Math.abs(MINI.x - centerX) < 0.5 &&
        Math.abs(MINI.y - centerY) < 0.5;

    if (aligned && WORLD.map[MINI.worldRow][MINI.worldCol] === 0) {
        WORLD.map[MINI.worldRow][MINI.worldCol] = 5; // crushed breadcrumb
    }
}

// ---------------------------------------------------------
// Update Mini (ghost-style movement)
// ---------------------------------------------------------
function updateMini() {
    const speed = TILE_SIZE * MINI.speed * speedMultiplier;

    // Crush breadcrumbs when aligned
    miniCrushBreadcrumbs();

    // Move Mini
    const arrived = moveEntity(MINI, speed);

    if (arrived) {
        MINI.direction = getMiniDirection();
        setNextTarget(MINI, MINI.direction);
    }

    // Collision with Pacman/Ikarus
    const dx = MINI.x - pacman.x;
    const dy = MINI.y - pacman.y;
    const dist = Math.hypot(dx, dy);

    if (dist < TILE_SIZE * 0.5) {
        handlePacmanDeath();
    }
}


/* =========================================================
   End of Block 5M.0
   ========================================================= */

/* =========================================================
    Reordered inside Block 2 - BLOCK 5M.4 — DRAW MINI (pixel-art)
   ========================================================= */

function drawMini() {
    ctx.save();

    // --- CAMERA TRANSLATION ---
    const screenX = MINI.x - CAMERA.col * TILE_SIZE;
    const screenY = MINI.y - CAMERA.row * TILE_SIZE;

    // --- ANCHOR OFFSETS (tune visually) ---
    // Mini is 42×39, so he sits slightly lower than Ikarus.
    const anchorOffsetX = -TILE_SIZE * 0.5;   // slight left shift
    const anchorOffsetY = -TILE_SIZE * 0.5;   // lift up to center him

    ctx.translate(screenX + anchorOffsetX, screenY + anchorOffsetY);

    // --- PICK SPRITE BASED ON DIRECTION ---
    const sprite = MINI_SPRITE_MAP[MINI.direction];

    // --- SCALE TO TILE SIZE ---
    const scaleX = TILE_SIZE / sprite.width;
    const scaleY = TILE_SIZE / sprite.height;
    const desiredScale = 1.2;   // 120% of tile size
    ctx.scale(scaleX * desiredScale, scaleY * desiredScale);

    ctx.scale(scaleX, scaleY);

    // --- DRAW PIXELS ---
    for (let row = 0; row < sprite.height; row++) {
        for (let col = 0; col < sprite.width; col++) {
            const colorIndex = sprite.pixels[row][col];
            if (colorIndex === 0) continue; // transparent

            ctx.fillStyle = sprite.palette[colorIndex];
            ctx.fillRect(col, row, 1, 1);
        }
    }

    ctx.restore();
}

/* =========================================================
    Reordered inside Block 2 - End of Block 5M.4
   ========================================================= */



/* =========================================================
   End of Block 5M
   ========================================================= */

/* =========================================================
   Reordered inside Block 2 - BLOCK 3.1 — DIRECTIONS, GRID SAFETY, PIXEL MATH
   ========================================================= */

// --- DIRECTIONS ---
const DIRS = {
    UP:    { x:  0, y: -1 },
    DOWN:  { x:  0, y:  1 },
    LEFT:  { x: -1, y:  0 },
    RIGHT: { x:  1, y:  0 }
};

function oppositeDirection(dir) {
    return (
        dir === 'UP'    ? 'DOWN'  :
        dir === 'DOWN'  ? 'UP'    :
        dir === 'LEFT'  ? 'RIGHT' :
        dir === 'RIGHT' ? 'LEFT'  :
        dir
    );
}

// --- GRID SAFETY (GLOBAL WORLD) ---
function isWall(worldCol, worldRow) {
    if (
        worldCol < 0 || worldCol >= WORLD.width ||
        worldRow < 0 || worldRow >= WORLD.height
    ) return true;

    const tile = WORLD.map[worldRow][worldCol];
    return tile === 1;
}

// --- GRID ↔ PIXEL ---
function getCenterPixel(worldCol, worldRow) {
    return {
        x: worldCol * TILE_SIZE + TILE_SIZE / 2,
        y: worldRow * TILE_SIZE + TILE_SIZE / 2
    };
}

/* =========================================================
   End of Block 3.1
   ========================================================= */


/* =========================================================
   BLOCK 2.4 — BUILD THE FULL WORLD MAP (MVP8)
   ========================================================= */

/* =========================================================
   BLOCK 2.4 — BUILD THE FULL WORLD MAP (MVP8)
   ========================================================= */

/* ---------------------------------------------------------
   2.4.1 BUILD A 39×33 LABYRINTH BY STITCHING 9 ROOM_TEMPLATES
         (3 rows × 3 columns of 13×11 rooms)
--------------------------------------------------------- */

function buildMegaMap() {
    const roomH = ROOM_TEMPLATE.length;        // 13
    const roomW = ROOM_TEMPLATE[0].length;     // 11

    const worldH = roomH * 3;                  // 39
    const worldW = roomW * 3;                  // 33

    // Create empty world
    const world = Array.from({ length: worldH }, () =>
        Array.from({ length: worldW }, () => 1)
    );

    // Stitch rooms into the world
    for (let ry = 0; ry < 3; ry++) {
        for (let rx = 0; rx < 3; rx++) {

            const offsetR = ry * roomH;
            const offsetC = rx * roomW;

            for (let r = 0; r < roomH; r++) {
                for (let c = 0; c < roomW; c++) {
                    world[offsetR + r][offsetC + c] =
                        ROOM_TEMPLATE[r][c];
                }
            }
        }
    }

    WORLD.width = worldW;
    WORLD.height = worldH;

    return world;
}

/* ---------------------------------------------------------
   2.4.2 INITIAL WORLD BUILD
--------------------------------------------------------- */

WORLD.map = buildMegaMap();

/* ---------------------------------------------------------
   2.4.3 RANDOM KEY PLACEMENT (GLOBAL)
--------------------------------------------------------- */

let hasKey = false;
let keyPos = null;
let exitPos = null;

function placeKey() {
    let attempts = 0;

    while (attempts < 2000) {
        const r = Math.floor(Math.random() * WORLD.height);
        const c = Math.floor(Math.random() * WORLD.width);

        const tile = WORLD.map[r][c];

        if (tile === 0 || tile === 2) {
            WORLD.map[r][c] = 3;   // key
            return { r, c };
        }

        attempts++;
    }

    return null;
}

/* ---------------------------------------------------------
   2.4.4 EXIT PLACEMENT (FIXED + RANDOM + DISPATCHER)
--------------------------------------------------------- */

function placeExitFixed() {
    const r = 1;
    const c = 1;

    if (WORLD.map[r][c] === 1) {
        WORLD.map[r][c] = 0;
    }

    WORLD.map[r][c] = 4;
    return { r, c };
}

function placeExitRandom() {
    let attempts = 0;

    while (attempts < 5000) {
        const r = Math.floor(Math.random() * WORLD.height);
        const c = Math.floor(Math.random() * WORLD.width);

        const tile = WORLD.map[r][c];

        if (tile === 2) {
            WORLD.map[r][c] = 4;
            return { r, c };
        }

        attempts++;
    }

    return null;
}

function placeExitBasedOnMode() {
    if (exitMode === "FIXED") {
        return placeExitFixed();
    } else {
        return placeExitRandom();
    }
}

function showExitDebugMessage() {
    const msg = document.getElementById("message");
    msg.textContent = `EXIT @ (${exitPos.r}, ${exitPos.c})`;
    msg.classList.remove("hidden");

    setTimeout(() => {
        msg.classList.add("hidden");
    }, 3000);
}

/* ---------------------------------------------------------
   2.4.5 SEAL OUTER BORDERS
--------------------------------------------------------- */

function sealWorldBorders() {
    for (let c = 0; c < WORLD.width; c++) {
        WORLD.map[0][c] = 1;
        WORLD.map[WORLD.height - 1][c] = 1;
    }
    for (let r = 0; r < WORLD.height; r++) {
        WORLD.map[r][0] = 1;
        WORLD.map[r][WORLD.width - 1] = 1;
    }
}

/* ---------------------------------------------------------
   2.4.6 REBUILD WORLD + RESTART GAME (for exitMode changes)
--------------------------------------------------------- */

function rebuildWorldAndRestart() {
    WORLD.map = buildMegaMap();
    keyPos = placeKey();
    exitPos = placeExitBasedOnMode();
    sealWorldBorders();
    resetGame();
}

/* ---------------------------------------------------------
   2.4.7 INITIAL KEY + EXIT + BORDERS
--------------------------------------------------------- */

keyPos  = placeKey();
exitPos = placeExitBasedOnMode();
sealWorldBorders();

/* =========================================================
   End of Block 2.4
   ========================================================= */

/* =========================================================
   End of Block 2
   ========================================================= */


/* =========================================================
   BLOCK 3 — GRID, MOVEMENT & COLLISION HELPERS (MVP8)
   ========================================================= */


/* =========================================================
   BLOCK 3.2 — MOVEMENT, TARGETING, CANVAS SIZE (MVP8)
   ========================================================= */

// --- MOVEMENT CHECK (GLOBAL) ---
function canMove(entity, direction) {
    const d = DIRS[direction];
    const col = entity.worldCol + d.x;
    const row = entity.worldRow + d.y;

    if (
        row < 0 || row >= WORLD.height ||
        col < 0 || col >= WORLD.width
    ) {
        return false;
    }

    const tile = WORLD.map[row][col];
    return isPassable(tile);
}

// --- TARGET TILE (GLOBAL) ---
function setNextTarget(entity, direction) {
    const d = DIRS[direction];

    const nextCol = entity.worldCol + d.x;
    const nextRow = entity.worldRow + d.y;

    // Out of bounds or blocked
    if (
        nextRow < 0 || nextRow >= WORLD.height ||
        nextCol < 0 || nextCol >= WORLD.width ||
        !isPassable(WORLD.map[nextRow][nextCol])
    ) {
        entity.nextCol = entity.worldCol;
        entity.nextRow = entity.worldRow;
        entity.targetX = entity.x;
        entity.targetY = entity.y;
        return;
    }

    entity.nextCol = nextCol;
    entity.nextRow = nextRow;

    const { x, y } = getCenterPixel(nextCol, nextRow);
    entity.targetX = x;
    entity.targetY = y;
}

// --- MOVE TOWARD TARGET (GLOBAL GRID) ---
function moveEntity(entity, speed, threshold = ARRIVAL_THRESHOLD) {
    const dx = entity.targetX - entity.x;
    const dy = entity.targetY - entity.y;

    // Arrived at tile center
    if (Math.abs(dx) < threshold && Math.abs(dy) < threshold) {
        entity.x = entity.targetX;
        entity.y = entity.targetY;

        // Snap to integer tile coordinates
        entity.worldCol = entity.nextCol;
        entity.worldRow = entity.nextRow;

        return true;
    }

    const dist = Math.hypot(dx, dy);
    const step = Math.min(speed, dist);

    entity.x += (dx / dist) * step;
    entity.y += (dy / dist) * step;

    // Do NOT update worldRow/worldCol until arrival
    return false;
}

// --- CANVAS & TILE SIZE (BASED ON VIEW WINDOW) ---
function resizeCanvas() {
    const container = canvas.parentElement;

    const maxWidth  = container.clientWidth  || window.innerWidth;
    const maxHeight = container.clientHeight || window.innerHeight;

    TILE_SIZE = Math.max(
        8,
        Math.floor(
            Math.min(
                maxWidth  / VIEW_WIDTH,
                maxHeight / VIEW_HEIGHT
            )
        )
    );

    TILE_SIZE = Math.floor(TILE_SIZE);  // force integer size

    canvas.width  = TILE_SIZE * VIEW_WIDTH;
    canvas.height = TILE_SIZE * VIEW_HEIGHT;

    pacman.radius = TILE_SIZE * 0.42;
}

window.addEventListener('resize', resizeCanvas);

/* =========================================================
   End of Block 3.2 (MVP8)
   ========================================================= */


/* =========================================================
   End of Block 3
   ========================================================= */

/* =========================================================
   BLOCK 4 — WORLD RENDERING (CAMERA WINDOW, MVP8)
   ========================================================= */

const DEBUG_SHOW_EXIT = true;   // turn off later

function drawTile(tile, x, y) {
    ctx.save();

    // Night distance falloff
    let dist = 0;
    if (isNight) {
        const dx = (x + TILE_SIZE / 2) - pacman.x;
        const dy = (y + TILE_SIZE / 2) - pacman.y;
        dist = Math.sqrt(dx * dx + dy * dy) / TILE_SIZE;
    }

    // WALL
    if (tile === 1) {
        if (isNight) {
            const brightness = Math.max(0.30, 1 - dist * 0.10);
            const r = Math.floor(parseInt(wallColor.slice(1,3),16) * brightness);
            const g = Math.floor(parseInt(wallColor.slice(3,5),16) * brightness);
            const b = Math.floor(parseInt(wallColor.slice(5,7),16) * brightness);
            ctx.fillStyle = `rgb(${r},${g},${b})`;
        } else {
            //ctx.fillStyle = wallColor;
	    ctx.fillStyle = "#2E7D32"; // deep garden green

        }
        ctx.fillRect(x, y, TILE_SIZE, TILE_SIZE);
        ctx.restore();
        return;
    }

    // FLOOR
    let brightness = 1;
    if (isNight) brightness = Math.max(0.25, 1 - dist * 0.10);
    ///ctx.fillStyle = `rgba(0,0,0,${brightness})`;
    ctx.fillStyle = "#4CAF50";

    ctx.fillRect(x, y, TILE_SIZE, TILE_SIZE);

    // PELLET
    if (tile === 0) {
        let b = 1;
        if (isNight) {
            b = Math.max(0.15, 1 - dist * 0.12);
            ctx.save();
            ctx.shadowColor = `rgba(255,255,255,${b})`;
            ctx.shadowBlur = 8 * b;
        }

        ctx.fillStyle = `rgba(255,255,255,${b})`;
        ctx.beginPath();
        ctx.arc(
            x + TILE_SIZE / 2,
            y + TILE_SIZE / 2,
            TILE_SIZE * 0.1,
            0, Math.PI * 2
        );
        ctx.fill();

        if (isNight) ctx.restore();
    }

    // CRUSHED BREADCRUMB
    if (tile === 5) {
        ctx.fillStyle = "rgba(255, 180, 120, 0.35)";
        ctx.beginPath();
        ctx.arc(
            x + TILE_SIZE / 2,
            y + TILE_SIZE / 2,
            TILE_SIZE * 0.08,
            0, Math.PI * 2
        );
        ctx.fill();
    }


// KEY (Armor Waiting Sprite) + small pulse
if (tile === 3) {
    const sprite = WINGS_KEY_SPRITE;

    const scale = (TILE_SIZE / sprite.width) * (0.5 + 0.1 * Math.sin(performance.now() * 0.005));

    ctx.save();
    ctx.translate(x + TILE_SIZE / 2, y + TILE_SIZE / 2);
    ctx.scale(scale, scale);
    ctx.translate(-sprite.width / 2, -sprite.height / 2);

    drawPixelSprite(ctx, sprite, 1);

    ctx.restore();
}

// EXIT
if (tile === 4) {
    const centerX = x + TILE_SIZE / 2;
    const centerY = y + TILE_SIZE / 2;
    const pulse = 0.85 + 0.30 * Math.sin(performance.now() * 0.004);

    ctx.save();

    if (!hasKey) {
        // Soft, subtle "it's here" glow
        ctx.fillStyle = `rgba(255,255,255,0.20)`;
        ctx.beginPath();
        ctx.arc(centerX, centerY, TILE_SIZE * 0.25 * pulse, 0, Math.PI * 2);
        ctx.fill();
    } else {
        // Big, inviting "the way is open" glow
        const bigPulse = 1.3 + 0.2 * Math.sin(performance.now() * 0.004);

        ctx.translate(centerX, centerY);
        ctx.scale(bigPulse, bigPulse);

        ctx.fillStyle = "rgba(255,255,200,0.35)";
        ctx.beginPath();
        ctx.arc(0, 0, TILE_SIZE * 0.35, 0, Math.PI * 2);
        ctx.fill();
    }

    ctx.restore();
    return;
}

ctx.restore();
} // closes drawTile()

//-----------

function drawSpriteAt(sprite, x, y) {
    ctx.save();
    ctx.translate(x, y);

    const scale = TILE_SIZE / sprite.width;
    ctx.scale(scale, scale);

    // Center the sprite
    ctx.translate(-sprite.width / 2, -sprite.height / 2);

    drawPixelSprite(ctx, sprite, 1);
    ctx.restore();
}

//-------------

function drawWingPickupMoment() {
    const pulse = 0.8 + 0.2 * Math.sin(performance.now() * 0.004);

    // Dim the world
    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Spotlight around Ikarus
    ctx.save();
    ctx.globalCompositeOperation = "destination-out";
    ctx.beginPath();
    ctx.arc(pacman.x, pacman.y, TILE_SIZE * 2.2 * pulse, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    // Message
    if (window.showWingMessage) {
        ctx.fillStyle = "white";
        ctx.font = `${TILE_SIZE * 0.7}px serif`;
        ctx.textAlign = "center";
        ctx.fillText(
            "Join us, little one…",
            canvas.width / 2,
            canvas.height * 0.75
        );
    }
}


// ------------


function drawVictorySequence() {
    const t = (performance.now() - window.victoryStart) / 1000;

    // 1. Ikarus floats upward
    const rise = Math.min(t * TILE_SIZE * 1.2, canvas.height);
    drawPacmanAt(pacman.x, pacman.y - rise);

    // 2. Fade to white after 1.5s
    if (t > 1.5) {
        const fade = Math.min((t - 1.5) / 1.2, 1);
        ctx.fillStyle = `rgba(255,255,255,${fade})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 3. Final celebration
        if (fade === 1) {
            drawFinalCelebration();
        }
    }
}

//-----------

function drawFinalCelebration() {
    ctx.fillStyle = "black";
    ctx.font = `${TILE_SIZE * 0.8}px serif`;
    ctx.textAlign = "center";
    ctx.fillText(
        "You made it, little one!",
        canvas.width / 2,
        canvas.height * 0.25
    );

    const t = (performance.now() - window.victoryStart) / 1000;
    const offset = (t * TILE_SIZE * 1.5) % (canvas.width + TILE_SIZE * 3);

    // Apollo
    drawSpriteAt(APOLLO_SPRITE, offset - TILE_SIZE * 3, canvas.height * 0.55);

    // Artemis
    drawSpriteAt(ARTEMIS_SPRITE, offset - TILE_SIZE * 2, canvas.height * 0.55);

    // Winged Ikarus (placeholder)
    drawSpriteAt(IKARUS_WINGED_FLY, offset - TILE_SIZE, canvas.height * 0.55);
}

//------------

function drawVisibleWorld() {

    ctx.save();

    // --- CLIP TO VIEWPORT ---
    ctx.beginPath();
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.clip();

    // --- FRACTIONAL CAMERA OFFSET ---
    const offsetX = CAMERA.col * TILE_SIZE;
    const offsetY = CAMERA.row * TILE_SIZE;

    // --- OVERSCAN: draw 1 tile beyond each edge ---
    const startRow = Math.floor(CAMERA.row) - 1;
    const endRow   = Math.floor(CAMERA.row) + VIEW_HEIGHT + 1;

    const startCol = Math.floor(CAMERA.col) - 1;
    const endCol   = Math.floor(CAMERA.col) + VIEW_WIDTH + 1;

    for (let r = startRow; r <= endRow; r++) {
        if (r < 0 || r >= WORLD.height) continue;

        for (let c = startCol; c <= endCol; c++) {
            if (c < 0 || c >= WORLD.width) continue;

            const tile = WORLD.map[r][c];

            const screenX = c * TILE_SIZE - offsetX;
            const screenY = r * TILE_SIZE - offsetY;

            drawTile(tile, screenX, screenY);
        }
    }

    ctx.restore();

//----------


    // DEBUG EXIT LABEL
    if (DEBUG_SHOW_EXIT && exitPos) {
        ctx.save();
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        ctx.font = `${TILE_SIZE * 0.4}px sans-serif`;
        ctx.textAlign = "left";
        ctx.fillText(
            `EXIT @ (${exitPos.r}, ${exitPos.c})`,
            10,
            canvas.height - 10
        );
        ctx.restore();
    }

}   // ← THIS closes drawVisibleWorld() — you were missing it!



/* =========================================================
   END OF BLOCK 4 (MVP8)
   ========================================================= */

/* =========================================================
   BLOCK 5 — PAC-MAN / IKARUS LOGIC (MVP8)
   ========================================================= */


/* ============================
    5.0A (Block 13c) - pixel references needed in 5 Block 13 c -IKARUS
   ============================ */

/* ============================
      IKARUS PALETTE
   ============================ */

const IKARUS_PALETTE = {
    0: "transparent",
    1: "#b48a3c",   // hair - soft brown / dark yellow
    2: "#8a6230",   // accents - mid brown
    3: "#000000",   // black
    4: "#f6e27a",   // light yellow highlight
    5: "#f5f0e6",   // clothing - white/cream
    6: "#f2d2b6"    // skin - warm cream
};


/* ============================
      IKARUS FRONT
   ============================ */

const IKARUS_FRONT = {
    width: 42,
    height: 42,
    palette: IKARUS_PALETTE,
    pixels: 

[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,6,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,2,2,6,6,6,2,1,6,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,1,1,1,6,6,3,3,1,2,6,6,6,6,3,3,0,6,6,2,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,6,2,6,6,3,6,6,6,6,6,6,6,6,6,6,3,6,6,2,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,1,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,2,6,6,6,3,1,6,6,6,6,6,6,3,1,6,6,6,6,1,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,3,3,6,6,6,6,6,6,3,3,6,6,6,6,2,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,3,6,6,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,3,3,3,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,3,3,3,6,6,6,6,6,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,3,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,6,6,6,6,6,6,6,6,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,1,6,6,6,6,6,6,6,6,6,1,5,5,5,2,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,6,6,6,6,6,6,6,1,4,1,4,1,4,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,6,6,6,0,6,6,6,6,1,1,5,1,4,4,4,1,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,6,6,6,0,6,6,1,1,5,5,5,4,4,2,4,4,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,3,0,6,6,6,3,1,1,1,5,5,5,5,5,1,4,4,4,1,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,0,0,3,1,5,5,5,5,5,5,5,5,4,1,4,1,4,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,1,1,1,5,5,5,1,5,5,5,5,5,5,5,1,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,1,5,5,5,1,5,5,5,5,5,5,5,5,5,1,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,5,1,1,5,5,5,5,5,5,5,5,1,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,4,3,4,4,3,4,5,5,5,5,5,1,1,1,1,5,5,5,5,5,1,0,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,4,3,4,4,3,4,1,1,1,5,5,5,5,5,5,5,1,1,1,5,1,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,4,3,4,4,3,4,6,6,6,6,1,1,1,1,1,1,6,6,6,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,3,3,3,3,3,3,6,6,6,6,0,0,0,0,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,0,0,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]
};


/* ============================
      IKARUS BACK
   ============================ */

const IKARUS_BACK = {
    width: 42,
    height: 42,
    palette: IKARUS_PALETTE,
    pixels: 

[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,1,1,2,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,2,1,1,1,2,2,1,1,1,1,1,1,1,1,2,1,1,1,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,1,1,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,2,1,1,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,1,1,2,2,2,2,1,1,1,1,1,1,1,2,1,1,1,1,1,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,6,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,2,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,1,2,1,1,2,1,1,1,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,6,2,2,2,1,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,5,5,1,6,2,6,6,6,6,6,6,1,6,0,0,0,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,6,1,5,5,5,1,6,6,6,6,6,6,6,6,6,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,6,6,1,5,5,5,5,1,1,6,6,6,6,6,6,6,6,6,1,1,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,6,6,6,1,5,5,5,5,5,5,1,6,6,6,6,6,6,6,6,6,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,6,6,6,1,5,1,5,5,5,5,5,1,1,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,6,6,6,6,1,5,5,1,5,5,5,5,5,5,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,6,6,6,1,5,5,5,5,1,1,5,5,1,5,5,5,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,6,6,1,5,5,5,5,5,5,5,5,1,1,5,5,1,0,4,0,4,4,0,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,6,6,1,5,5,5,5,5,5,5,5,5,5,5,5,1,1,4,0,4,4,0,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,1,6,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,0,4,4,0,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,6,0,0,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,5,5,5,5,5,1,1,1,1,5,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,6,6,6,1,1,1,1,1,6,6,6,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,0,0,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,0,0,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]
};


/* ============================
      IKARUS LEFT
   ============================ */

const IKARUS_LEFT = {
    width: 42,
    height: 42,
    palette: IKARUS_PALETTE,
    pixels: 
[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,0,1,2,1,1,1,2,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,2,6,6,1,1,2,1,1,1,1,1,1,2,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,6,3,3,6,2,6,2,1,1,2,1,1,1,2,1,1,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,6,6,6,3,6,6,2,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,2,2,1,1,1,1,2,1,1,1,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,6,3,1,6,6,6,6,2,1,1,2,6,6,6,1,1,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,6,3,3,6,6,6,6,6,1,1,6,6,1,6,2,1,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,2,6,6,1,6,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,6,6,6,6,6,6,6,6,6,6,2,6,6,6,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,6,6,6,6,6,6,6,0,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,6,6,6,6,6,6,6,6,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,6,6,6,1,6,0,0,0,0,6,6,1,1,1,1,1,1,5,5,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,6,6,6,1,6,6,6,6,6,5,1,4,1,4,1,6,6,1,5,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,6,3,6,1,6,6,6,6,1,1,4,4,4,1,1,6,6,6,1,5,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,0,3,1,6,6,6,1,5,4,4,2,4,4,1,6,6,6,6,5,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,6,1,5,1,4,4,4,1,1,6,6,6,6,5,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,1,5,5,4,1,4,1,4,1,2,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,1,5,5,5,5,5,5,5,5,5,5,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,0,3,4,4,3,0,5,5,5,5,5,5,5,5,5,5,1,6,6,6,5,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,5,5,5,5,5,5,5,5,5,5,5,6,6,6,5,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,5,5,5,5,5,5,5,5,5,5,6,6,6,6,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,5,5,5,5,5,5,5,1,5,5,5,6,6,6,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,5,5,1,1,1,6,1,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,6,6,6,0,5,1,1,1,1,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,0,0,0,0,6,6,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,0,0,0,0,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]
};


/* ============================
      IKARUS RIGHT
   ============================ */

const IKARUS_RIGHT = {
    width: 42,
    height: 42,
    palette: IKARUS_PALETTE,
    pixels: 
[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,1,2,1,2,1,1,2,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,1,2,6,6,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,2,1,1,2,6,2,6,6,6,6,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,2,1,1,1,1,2,2,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,2,6,1,2,1,1,2,6,6,6,6,1,3,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,6,1,6,6,1,1,6,6,6,6,6,3,3,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,6,1,6,6,2,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,6,6,6,2,6,6,6,6,6,6,6,1,1,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,6,6,6,6,6,6,6,6,6,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,6,6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,6,6,1,5,5,5,0,0,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,1,4,5,4,5,6,1,1,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,6,6,6,6,6,6,6,6,6,6,6,1,1,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,1,1,0,3,0,3,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,1,1,6,6,6,6,6,6,6,6,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,1,1,5,5,5,5,6,6,5,5,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,6,6,6,1,5,5,5,5,5,5,5,5,5,5,5,0,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,0,4,3,4,4,3,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,4,3,4,4,3,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,4,3,4,4,3,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,1,5,5,5,5,5,5,5,0,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,1,6,1,1,5,5,5,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,6,6,6,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,0,0,0,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,0,0,0,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]
};

/* ============================
      IKARUS EXPORT / ASSEMBLY
  ============================ */
const IKARUS_SPRITES = { 
	UP: IKARUS_BACK, 
	DOWN: IKARUS_FRONT, 
	LEFT: IKARUS_LEFT, 
	RIGHT: IKARUS_RIGHT };



/* =========================================================
   End of BLOCK 5.0A (13C)
   ========================================================= */

/* =========================================================
   5.0D BLOCK 13F — IKARUS (WINGED) — SPRITES + PALETTE
   ========================================================= */

/* ---------------------------------------------------------
   PALETTE — Winged Ikarus
   --------------------------------------------------------- */

const IKARUS_WINGED_PALETTE = [
    "transparent",   // 0 — transparent
    "#a66c3a",       // 1 — leather / copper
    "#b48a3c",       // 2 — Ikarus hair / eyes
    "#2c2c2c",       // 3 — black
    "#FFC000",       // 4 — Apollo’s gold
    "#f5f0e6",       // 5 — wings / white-ish
    "#f2d2b6",       // 6 — Ikarus skin
    "#BFBFBF"        // 7 — Artemis silver
];




/* ---------------------------------------------------------
   IKARUS_WINGED_UP — 42×42
   --------------------------------------------------------- */

const IKARUS_WINGED_UP = {
    width: 42,
    height: 42,
    palette: IKARUS_WINGED_PALETTE,
    pixels: [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,5,5,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,5,5,0,0,0,0,0],
[0,0,0,0,5,5,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,5,5,0,0,0,0,0],
[0,0,5,7,5,5,5,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,5,5,5,7,5,0,0,0],
[0,7,5,5,5,7,5,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,5,7,5,5,5,7,0,0],
[5,5,7,5,5,7,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,7,5,5,7,5,5,0],
[5,5,5,5,5,7,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,7,1,1,5,5,5,7,5,5,5,5,5,0],
[7,7,5,5,5,5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,1,5,5,5,5,5,5,5,7,7,0],
[5,7,7,7,5,5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,7,7,7,5,0],
[5,5,5,5,7,5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,7,5,5,5,5,0],
[0,7,5,5,5,5,7,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,7,5,5,5,5,7,0,0],
[0,5,5,5,5,5,7,7,7,7,5,5,5,5,5,5,5,6,6,6,6,6,6,6,5,5,5,5,5,5,5,7,7,7,7,5,5,5,5,5,0,0],
[0,0,5,7,5,5,5,5,5,7,5,5,5,5,5,5,5,5,5,6,6,6,5,5,5,5,5,5,5,5,5,7,5,5,5,5,5,7,5,0,0,0],
[0,0,5,5,7,5,5,5,5,7,7,5,5,5,5,5,5,5,5,7,7,7,5,5,5,5,5,5,5,5,7,7,5,5,5,5,7,5,5,0,0,0],
[0,0,7,5,5,5,5,5,5,5,5,7,5,5,5,5,5,1,1,1,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,7,0,0,0],
[0,0,0,0,7,7,5,5,5,5,5,5,5,5,5,5,5,7,1,1,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,7,7,0,0,0,0,0],
[0,0,0,0,5,5,5,5,5,5,5,5,5,7,5,5,5,7,7,7,4,7,7,7,5,5,5,7,5,5,5,5,5,5,5,5,5,0,0,0,0,0],
[0,0,0,0,7,5,5,7,7,5,5,5,5,7,5,5,5,1,7,7,4,7,7,1,5,5,5,7,5,5,5,5,7,7,5,5,7,0,0,0,0,0],
[0,0,0,0,5,5,5,5,5,5,5,5,5,7,5,5,5,1,1,7,4,7,1,1,5,5,5,7,5,5,5,5,5,5,5,5,5,0,0,0,0,0],
[0,0,0,0,7,7,7,5,5,5,5,5,5,7,5,5,5,1,1,5,4,5,1,1,5,5,5,7,5,5,5,5,5,5,7,7,7,0,0,0,0,0],
[0,0,0,0,0,0,5,5,5,5,5,5,5,7,5,1,1,1,1,5,4,5,1,1,1,1,5,7,5,5,5,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,5,6,6,5,5,5,5,7,5,1,1,1,1,1,1,1,1,1,1,1,5,7,5,5,5,5,3,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,5,5,5,5,7,5,5,5,1,5,5,5,5,5,1,5,5,5,7,5,5,5,5,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,0,5,5,5,5,7,5,5,7,7,5,5,5,5,5,7,7,5,5,7,5,5,5,5,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,7,5,5,5,5,7,7,5,5,5,5,5,5,5,7,7,5,5,5,5,7,5,3,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,7,5,5,5,5,7,5,5,5,5,5,5,5,5,5,7,5,5,5,5,7,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,7,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,5,5,5,5,7,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,6,6,6,6,0,0,0,6,6,6,6,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,6,6,6,6,0,0,0,6,6,6,6,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0]
] };

/* ---------------------------------------------------------
   IKARUS_WINGED_DOWN — 42×42
   --------------------------------------------------------- */
const IKARUS_WINGED_DOWN = {
    width: 42,
    height: 42,
    palette: IKARUS_WINGED_PALETTE,
    pixels: [

[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,4,7,7,7,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,4,4,7,7,4,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,4,7,7,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,4,7,7,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,5,5,0,0,1,1,1,1,1,1,1,1,4,4,7,7,4,1,1,1,1,1,1,1,1,1,1,1,0,0,0,5,5,0,0,0,0,0],
[0,0,0,0,5,5,0,0,1,1,1,1,1,1,1,1,1,1,4,7,7,7,1,1,1,1,1,1,1,1,1,1,0,0,0,5,5,0,0,0,0,0],
[0,0,5,7,5,5,5,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,5,5,5,7,5,0,0,0],
[0,7,5,5,5,7,5,0,0,2,1,1,1,6,6,3,3,1,2,6,6,6,6,3,3,0,6,6,2,1,1,0,0,0,5,7,5,5,5,7,0,0],
[5,5,7,5,5,7,5,5,5,2,6,2,6,6,3,6,6,6,6,6,6,6,6,6,6,3,6,6,2,1,1,5,5,5,5,7,5,5,7,5,5,0],
[5,5,5,5,5,7,5,5,5,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,1,6,5,5,5,5,7,5,5,5,5,5,0],
[7,7,5,5,5,5,5,5,5,6,6,2,6,6,6,3,2,6,6,6,6,6,6,3,2,6,6,6,6,1,6,6,5,5,5,5,5,5,5,7,7,0],
[5,7,7,7,5,5,5,5,5,6,6,6,6,6,6,3,3,6,6,6,6,6,6,3,3,6,6,6,6,2,6,6,5,5,5,5,5,7,7,7,5,0],
[5,5,5,5,7,5,5,5,5,6,6,6,6,6,6,6,6,6,3,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,7,5,5,5,5,0],
[0,7,5,5,5,5,7,5,5,5,6,6,6,6,6,6,6,6,3,3,3,6,6,6,6,6,6,6,6,6,6,5,5,5,7,5,5,5,5,7,0,0],
[0,5,5,5,5,5,7,7,7,7,5,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,5,7,7,7,7,5,5,5,5,5,0,0],
[0,0,5,7,5,5,5,5,5,7,5,5,2,6,6,6,6,6,6,3,6,3,6,6,6,6,6,6,2,5,5,7,5,5,5,5,5,7,5,0,0,0],
[0,0,5,5,7,5,5,5,5,7,7,5,5,6,6,6,6,6,6,6,3,6,6,6,6,6,6,6,5,5,7,7,5,5,5,5,7,5,5,0,0,0],
[0,0,7,5,5,5,5,5,5,5,5,7,5,5,2,2,2,2,6,6,6,6,6,2,2,2,2,5,5,7,7,5,5,5,5,5,5,5,7,0,0,0],
[0,0,0,0,7,7,5,5,5,5,5,5,6,6,2,2,2,4,2,2,4,2,2,4,2,2,2,6,6,5,5,5,5,5,5,7,7,0,0,0,0,0],
[0,0,0,0,5,5,5,5,5,5,2,2,2,2,2,2,2,2,4,2,4,2,4,2,2,2,2,6,6,6,5,5,5,5,5,5,5,0,0,0,0,0],
[0,0,0,0,7,5,5,7,7,6,6,6,6,6,2,2,2,2,2,4,4,4,2,2,2,2,2,6,6,6,6,5,7,7,5,5,7,0,0,0,0,0],
[0,0,0,0,5,5,5,5,5,6,6,6,6,6,2,2,4,4,4,4,2,4,4,4,4,2,2,2,6,6,6,5,5,5,5,5,5,0,0,0,0,0],
[0,0,0,0,7,7,7,5,3,5,6,6,6,3,2,2,2,2,2,4,4,4,2,2,2,2,2,2,6,6,6,5,5,5,7,7,7,0,0,0,0,0],
[0,0,0,0,0,0,5,5,5,3,5,5,3,2,2,2,2,2,4,2,4,2,4,2,2,2,2,2,6,6,6,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,5,5,3,3,3,3,3,2,2,2,2,4,2,2,4,2,2,4,2,2,2,2,6,6,6,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,4,3,4,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,6,6,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,4,3,4,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,4,3,4,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,3,3,3,3,3,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,0,0,0,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
] };

/* ---------------------------------------------------------
   IKARUS_WINGED_LEFT — 42×42
   --------------------------------------------------------- */

const IKARUS_WINGED_LEFT =
 { width: 42, height: 42, palette: IKARUS_WINGED_PALETTE, pixels: [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,5,5,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,5,5,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,6,6,6,3,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5,5,5,7,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5,7,5,5,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,6,3,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,7,5,5,7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,6,3,3,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,7,5,5,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,5,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,6,6,6,6,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,7,7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,6,6,6,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,7,5,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,6,6,6,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,7,5,5,5,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,6,6,6,6,1,1,1,1,1,1,1,1,1,1,1,5,7,7,7,7,5,5,5,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,1,1,1,1,1,1,1,1,1,5,5,5,7,5,5,5,5,5,7,5],
[0,0,0,0,0,0,0,0,0,0,0,6,6,6,1,6,0,0,0,0,6,6,6,6,6,6,6,6,6,5,5,5,5,7,7,5,5,5,5,7,5,5],
[0,0,0,0,0,0,0,0,0,0,1,6,6,6,1,6,6,6,6,6,1,1,2,2,2,2,2,2,2,2,5,5,5,5,5,5,5,5,5,5,5,7],
[0,0,0,0,0,0,0,0,0,0,1,6,3,6,1,6,6,6,6,6,1,4,1,4,1,6,6,6,6,2,5,5,5,5,5,5,5,5,7,7,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,0,3,1,6,6,6,6,6,1,4,4,1,1,6,6,6,6,2,5,5,5,5,5,5,5,5,5,5,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,4,4,1,6,1,1,6,6,2,2,5,5,5,5,5,7,7,5,5,7,0,0],
[0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,4,4,6,6,6,6,6,6,2,2,2,5,5,5,5,5,5,5,5,5,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,1,4,6,6,6,6,6,6,1,1,1,5,5,5,5,5,5,7,7,7,0,0],
[0,0,0,0,0,0,0,0,0,4,4,3,4,4,3,0,0,0,0,0,1,4,1,4,1,1,1,1,1,1,0,5,5,5,5,5,5,5,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,4,3,4,4,3,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,5,5,5,5,0,5,5,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,4,3,4,4,3,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,5,5,5,5,5,5,5,5,5,5,5,0,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,5,0,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,6,0,7,0,7,7,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,0,6,6,0,0,0,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,6,6,0,0,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0]
] };

/* ---------------------------------------------------------
   IKARUS_WINGED_RIGHT — 42×42
   --------------------------------------------------------- */

const IKARUS_WINGED_RIGHT =
{ width: 42, height: 42, palette: IKARUS_WINGED_PALETTE, pixels: [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,5,5,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,5,5,5,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,5,7,5,5,5,5,5,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,6,6,6,6,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,5,5,5,7,7,5,5,0,0,1,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,5,5,7,5,7,7,7,5,5,5,0,1,1,1,1,1,1,1,1,1,1,1,1,6,1,3,6,6,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,5,5,5,5,5,7,7,5,5,5,0,1,1,1,1,1,1,1,1,1,1,1,1,6,3,3,6,6,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,7,7,5,5,5,5,5,5,5,5,0,5,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0],
[0,5,7,7,7,7,5,5,5,5,5,0,5,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,5,7,5,5,5,5,5,7,5,5,5,5,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,5,5,5,5,5,5,5,7,5,5,5,5,1,1,1,1,1,1,1,1,1,1,6,6,6,1,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,5,5,5,5,5,5,5,7,7,5,7,7,1,1,1,1,1,1,1,1,1,1,6,6,6,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,5,7,5,5,5,5,5,5,5,5,7,5,5,1,1,1,1,1,1,1,1,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,5,5,7,5,5,5,5,7,7,5,5,5,5,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,7,5,5,5,5,5,5,5,5,5,5,1,1,1,1,1,1,1,4,1,1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,7,7,5,5,5,5,5,5,5,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,6,6,0,0,0,0,0,0,0,0],
[0,0,0,0,0,5,5,5,5,5,5,5,5,5,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,3,0,3,0,0,0,0,0,0,0,0],
[0,0,0,0,0,7,5,5,7,7,5,5,5,5,1,1,1,6,6,6,6,6,1,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0],
[0,0,0,0,0,5,5,5,5,5,5,5,5,5,1,1,1,1,1,1,1,1,4,1,4,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0],
[0,0,0,0,0,7,7,7,5,5,5,5,5,5,1,1,1,1,1,1,1,4,1,1,4,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0],
[0,0,0,0,0,0,0,5,5,5,5,5,5,5,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,3,4,4,3,4,4,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,3,4,4,3,4,4,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,3,4,4,3,4,4,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,6,6,0,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,6,6,0,0,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
] };

/* ---------------------------------------------------------
   WINGS KEY — Waiting to be collected
   --------------------------------------------------------- */

const IKARUS_WINGS_WAITING = {
    width: 42,
    height: 42,
    palette: IKARUS_WINGED_PALETTE,
    pixels: [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,4,7,7,7,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,4,4,7,7,4,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,4,7,7,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,4,7,7,4,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,5,5,0,0,1,1,1,1,1,1,1,1,4,4,7,7,4,1,1,1,1,1,1,1,1,1,1,1,0,0,0,5,5,0,0,0,0,0],
[0,0,0,0,5,5,0,0,1,1,1,1,1,1,1,1,1,1,4,7,7,7,1,1,1,1,1,1,1,1,1,1,0,0,0,5,5,0,0,0,0,0],
[0,0,5,7,5,5,5,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,5,5,5,7,5,0,0,0],
[0,7,5,5,5,7,5,0,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,5,7,5,5,5,7,0,0],
[5,5,7,5,5,7,5,5,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,0,0,0,5,5,5,5,5,5,7,5,5,7,5,5,0],
[5,5,5,5,5,7,5,5,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,1,1,1,1,1,1,1,5,5,5,7,5,5,5,5,5,0],
[7,7,5,5,5,5,5,5,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,1,1,1,1,1,1,1,1,5,5,5,5,5,5,5,7,7,0],
[5,7,7,7,5,5,5,5,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,1,1,1,1,1,1,1,1,1,5,5,5,5,5,7,7,7,5,0],
[5,5,5,5,7,5,5,5,1,1,1,1,1,1,1,1,1,1,1,7,7,7,1,1,1,1,1,1,1,1,1,1,5,5,5,5,7,5,5,5,5,0],
[0,7,5,5,5,5,7,5,5,5,5,5,5,5,5,5,5,5,5,7,7,7,5,5,5,5,5,5,5,5,5,5,5,5,7,5,5,5,5,7,0,0],
[0,5,5,5,5,5,7,7,7,7,5,5,5,5,5,5,5,5,5,7,7,7,5,5,5,5,5,5,5,5,5,7,7,7,7,5,5,5,5,5,0,0],
[0,0,5,7,5,5,5,5,5,7,5,5,5,5,5,5,5,5,5,7,7,7,5,5,5,5,5,5,5,5,5,7,5,5,5,5,5,7,5,0,0,0],
[0,0,5,5,7,5,5,5,5,7,7,5,5,5,5,5,5,5,5,7,7,7,5,5,5,5,5,5,5,5,7,7,5,5,5,5,7,5,5,0,0,0],
[0,0,7,5,5,5,5,5,5,5,5,7,5,5,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,5,5,5,5,5,5,5,5,5,7,0,0,0],
[0,0,0,0,7,7,5,5,5,5,5,5,5,5,2,2,2,4,2,2,4,2,2,4,2,2,2,5,5,5,5,5,5,5,5,7,7,0,0,0,0,0],
[0,0,0,0,5,5,5,5,5,5,5,5,5,5,2,2,2,2,4,2,4,2,4,2,2,2,2,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0],
[0,0,0,0,7,5,5,7,7,5,5,5,5,5,2,2,2,2,2,4,4,4,2,2,2,2,2,5,5,5,5,5,7,7,5,5,7,0,0,0,0,0],
[0,0,0,0,5,5,5,5,5,5,5,5,5,2,2,2,4,4,4,4,2,4,4,4,4,2,2,2,5,5,5,5,5,5,5,5,5,0,0,0,0,0],
[0,0,0,0,7,7,7,5,5,5,5,5,5,2,2,2,2,2,2,4,4,4,2,2,2,2,2,2,5,5,5,5,5,5,7,7,7,0,0,0,0,0],
[0,0,0,0,0,0,5,5,5,5,5,5,5,2,2,2,2,2,4,2,4,2,4,2,2,2,2,2,5,5,5,5,5,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,5,5,0,5,5,5,5,2,2,2,2,4,2,2,4,2,2,4,2,2,2,2,5,5,5,5,0,5,5,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,7,7,7,7,7,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,7,7,0,7,0,7,7,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,7,7,0,0,7,0,0,7,7,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,5,5,5,5,0,7,7,7,0,0,7,7,7,0,0,7,7,7,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,7,7,7,0,0,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
] };

/* ---------------------------------------------------------
   SPRITE MAP — Directional lookup
   --------------------------------------------------------- */

const IKARUS_WINGED_SPRITES   = {
    UP:    IKARUS_WINGED_UP,
    DOWN:  IKARUS_WINGED_DOWN,
    LEFT:  IKARUS_WINGED_LEFT,
    RIGHT: IKARUS_WINGED_RIGHT
};

const WINGS_KEY_SPRITE = IKARUS_WINGS_WAITING;


/* ---------------------------------------------------------
   IKARUS_WINGED_Flying
   --------------------------------------------------------- */

// Placeholder for end-screen flying Ikarus
   const IKARUS_WINGED_FLY = IKARUS_WINGED_DOWN;
// const IKARUS_WINGED_FLY = {
//     width: 42,
//     height: 42,
//     pixels: [ ... your flying matrix ... ]
// };
// 




/* =========================================================
   End of Block 13F
   ========================================================= */

/* ============================
    5.0D (Block 13F) - pixel references needed in 5 Block 13 F -Mini
   ============================ */

/* =========================================================
   BLOCK 13F — MINI SPRITES (42×39)
   ========================================================= */

const MINI_PALETTE = [
    "rgba(0,0,0,0)",   // 0 transparent
    "#f7f3e8",         // 1 horn white
    "#7a4b2f",         // 2 brown hair
    "#2b1f1f",         // 3 black details
    "#8b1e2d",         // 4 dark red
    "#e57a3c"          // 5 orange snout
];

const MINI_FRONT = {
    width: 42,
    height: 39,
    palette: MINI_PALETTE,
    pixels: 

[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,4,4,2,2,2,2,2,2,4,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,4,4,4,4,2,2,2,2,4,4,4,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,1,4,4,4,4,4,4,2,4,4,4,4,4,4,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,4,4,4,4,4,4,4,4,3,4,4,3,4,4,0,3,4,4,3,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,4,3,3,3,4,4,4,4,3,3,4,4,4,4,4,3,3,4,4,4,4,3,3,3,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,4,4,4,4,4,4,4,3,3,1,4,4,4,4,4,1,3,3,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,4,4,4,4,3,3,3,4,4,4,4,4,3,3,1,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,3,3,5,5,5,5,5,5,5,3,3,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,5,3,5,5,5,3,5,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,5,5,5,5,5,5,5,5,5,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,5,5,5,5,3,5,5,5,5,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,5,3,3,5,3,3,5,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,3,3,3,5,5,5,5,5,3,3,3,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,3,3,3,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,4,3,4,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,4,3,4,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,0,4,4,4,4,4,3,4,4,4,4,4,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,0,0,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]

};

const MINI_BACK = {
    width: 42,
    height: 39,
    palette: MINI_PALETTE,
    pixels: 
[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,2,2,2,2,2,2,2,2,2,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,2,2,2,2,2,2,2,2,2,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,2,2,2,2,2,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,2,2,2,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,4,2,4,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,4,4,4,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,0,4,4,4,4,4,4,4,4,4,4,4,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,0,0,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]

};

const MINI_LEFT = {
    width: 42,
    height: 39,
    palette: MINI_PALETTE,
    pixels: 
[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,4,4,4,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,1,1,1,1,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,1,1,1,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,3,4,4,4,4,4,4,4,4,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,4,4,3,4,4,4,4,4,4,2,2,2,4,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,4,4,4,4,4,4,2,2,4,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,4,1,1,4,4,4,4,4,4,4,2,2,4,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,5,5,1,1,4,4,4,4,4,4,4,4,4,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,1,4,4,4,4,4,4,4,4,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,3,5,5,4,4,4,4,4,4,4,4,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,5,5,5,5,4,4,4,4,4,4,4,4,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,3,5,4,4,4,4,4,4,4,4,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,5,5,4,4,4,4,4,4,4,4,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,4,4,4,4,4,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,4,4,4,4,4,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,4,4,4,4,4,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,3,3,3,3,3,0,2,3,3,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,3,3,3,3,3,3,2,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,2,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,2,2,2,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,2,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]

};

const MINI_RIGHT = {
    width: 42,
    height: 39,
    palette: MINI_PALETTE,
    pixels: 
[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,4,4,4,4,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,1,1,1,1,1,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,2,2,2,2,1,1,1,1,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,1,1,1,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,4,2,2,2,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,4,2,2,4,4,4,4,4,4,4,4,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,4,2,2,4,4,4,4,4,4,4,3,1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,2,4,4,4,4,4,4,4,4,4,3,3,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,4,4,4,4,4,4,4,4,3,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,4,4,4,4,4,4,4,4,5,5,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,4,4,4,4,4,4,4,4,5,5,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,4,4,4,4,4,4,4,4,5,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,4,4,4,4,4,4,4,4,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,2,4,4,4,4,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,2,4,4,4,4,4,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,2,4,4,4,4,4,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,4,4,3,3,3,3,3,3,3,3,3,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,3,3,2,2,2,2,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,3,3,3,2,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]

};

const MINI_SPRITE_MAP = {
    UP:    MINI_BACK,
    DOWN:  MINI_FRONT,
    LEFT:  MINI_LEFT,
    RIGHT: MINI_RIGHT
};

/* =========================================================
   End of BLOCK 5.0D (13F)
   ========================================================= */






/* =========================================================
   BLOCK 5.1 — INPUT (KEYBOARD + TOUCH)
   ========================================================= */

// --- INPUT (KEYBOARD) ---
document.addEventListener('keydown', (e) => {
    const keyMap = {
        ArrowUp: 'UP', KeyW: 'UP',
        ArrowDown: 'DOWN', KeyS: 'DOWN',
        ArrowLeft: 'LEFT', KeyA: 'LEFT',
        ArrowRight: 'RIGHT', KeyD: 'RIGHT'
    };
    if (keyMap[e.code]) {
        pacman.requestedDirection = keyMap[e.code];
    }
});

// --- INPUT (TOUCH / SWIPE) ---
touchStartX = null;
touchStartY = null;
activeTouch = false;

swipeTarget.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const t = e.touches[0];
    touchStartX = t.clientX;
    touchStartY = t.clientY;
    activeTouch = true;
    pacman.requestedDirection = pacman.direction;
}, { passive: false });

swipeTarget.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!activeTouch) return;

    const t = e.touches[0];
    const dx = t.clientX - touchStartX;
    const dy = t.clientY - touchStartY;

    if (
        Math.abs(dx) < SWIPE_ACTIVATION_DISTANCE &&
        Math.abs(dy) < SWIPE_ACTIVATION_DISTANCE
    ) return;

//    if (Math.abs(dx) > Math.abs(dy)) {
//        pacman.requestedDirection = dx > 0 ? 'RIGHT' : 'LEFT';
//    } else {
//        pacman.requestedDirection = dy > 0 ? 'DOWN' : 'UP';
//    }

	if (Math.abs(dx) > Math.abs(dy)) {
	    pacman.requestedDirection = dx > 0 ? "RIGHT" : "LEFT";
	} else {
	    pacman.requestedDirection = dy > 0 ? "DOWN" : "UP";
	}


    touchStartX = t.clientX;
    touchStartY = t.clientY;
}, { passive: false });

swipeTarget.addEventListener('touchend', () => {
    activeTouch = false;
    touchStartX = null;
    touchStartY = null;
});

/* =========================================================
   End of Block 5.1
   ========================================================= */


/* =========================================================
   BLOCK 5.2 — TURN TOLERANCE & MOVEMENT HELPERS (MVP8)
   ========================================================= */

function isNearTileCenter(entity) {
    const center = getCenterPixel(entity.worldCol, entity.worldRow);
    const dx = Math.abs(entity.x - center.x);
    const dy = Math.abs(entity.y - center.y);

    return (
        dx < TILE_SIZE * TURN_TOLERANCE &&
        dy < TILE_SIZE * TURN_TOLERANCE
    );
}

/* =========================================================
   End of Block 5.2
   ========================================================= */

/* =========================================================
   Block 2.5 - story states
   ========================================================= */

window.wingMomentUntil = 0;
window.victoryMode = false;
window.victoryStart = 0;


/* =========================================================
   BLOCK 5.3 — UPDATE PAC-MAN / IKARUS (MVP8, GLOBAL WORLD)
   ========================================================= */

function updatePacman() {

    // --- WING MOMENT FREEZE ---
    if (performance.now() < window.wingMomentUntil) {
        // Pacman is frozen during the wing pickup moment
        return;
    }

    // --- VICTORY FLOAT MODE ---
    if (window.victoryMode) {
        // Pacman no longer moves normally
        return;
    }

    const speed = TILE_SIZE * PACMAN_SPEED * speedMultiplier;
	window.globalSlowFactor = 1;


    // --- TURNING ---
    if (
        pacman.requestedDirection !== pacman.direction &&
        canMove(pacman, pacman.requestedDirection) &&
        isNearTileCenter(pacman)
    ) {
        pacman.direction = pacman.requestedDirection;
        setNextTarget(pacman, pacman.direction);
    }

    // --- MOVE ---
    const arrived = moveEntity(pacman, speed);

    const r = pacman.worldRow;
    const c = pacman.worldCol;

    // --- PELLET / CRUSHED BREADCRUMB PICKUP ---
    if (WORLD.map[r][c] === 2) {
        WORLD.map[r][c] = 0;
        score += 10;
    }
    if (WORLD.map[r][c] === 5) {
        WORLD.map[r][c] = 0;
        score += 10;
    }

  // --- KEY PICKUP ---
    if (WORLD.map[r][c] === 3) {
    hasKey = true;
    WORLD.map[r][c] = 2;

    window.wingMomentUntil = performance.now() + 1200;
    window.showWingMessage = true;
    window.globalSlowFactor = 0.1;

    if (performance.now() < window.wingMomentUntil) {
        return;
    } else {
        window.globalSlowFactor = 1;
    }
}

    // --- EXIT COLLISION ---
    if (WORLD.map[r][c] === 4 && hasKey) {
    window.victoryMode = true;
    trioStartTime = null;
    window.victoryStart = performance.now();
    }

    // --- CONTINUE MOVING ---
    if (arrived && canMove(pacman, pacman.direction)) {
        setNextTarget(pacman, pacman.direction);
    }

    // --- MOUTH ANIMATION ---
    if (pacman.moving) {
        pacman.mouthAngle += pacman.mouthClosing ? -0.04 : 0.04;
        if (pacman.mouthAngle <= 0 || pacman.mouthAngle >= Math.PI / 4) {
            pacman.mouthClosing = !pacman.mouthClosing;
        }
    }
}

/* =========================================================
   End of Block 5.3
   ========================================================= */


/* =========================================================
   BLOCK 5.4 — DRAW PAC-MAN / IKARUS (PIXEL SPRITE VERSION)
   ========================================================= */
/* =========================================================
   BLOCK 5.4 — DRAW PAC-MAN / IKARUS (PIXEL SPRITE VERSION)
   ========================================================= */

function drawPacman() {

    // Determine direction (requestedDirection takes priority)
    const dir = pacman.requestedDirection || pacman.direction;

    // Choose correct sprite (winged or normal)
    const sprite = hasKey
        ? IKARUS_WINGED_SPRITES[dir]
        : IKARUS_SPRITES[dir];

    // Safety fallback (prevents undefined.width errors)
    if (!sprite) return;

    // Camera-relative position
    const screenX = pacman.x - CAMERA.col * TILE_SIZE;
    const screenY = pacman.y - CAMERA.row * TILE_SIZE;

    ctx.save();

    // Anchor offsets (same for winged + normal)
    const anchorOffsetX = -TILE_SIZE * 0.5;
    const anchorOffsetY = -TILE_SIZE * 0.5;

    ctx.translate(screenX + anchorOffsetX, screenY + anchorOffsetY);

    // Night glow
    if (isNight) {
        ctx.shadowColor = "#FFD93D";
        ctx.shadowBlur = 18;
    }

    // Death fade
    if (deathPhase === 'DYING' || deathPhase === 'RETURNING') {
        ctx.globalAlpha = pacmanFade;
    }

    // Scale so 42px sprite fits TILE_SIZE
    const scale = TILE_SIZE / sprite.width;

    drawPixelSprite(ctx, sprite, scale);

    ctx.restore();
}

function drawPacmanAt(screenX, screenY) {
    ctx.save();

    // Move to the custom position
    ctx.translate(screenX, screenY);

    // Determine direction (same logic as drawPacman)
    const dir = pacman.requestedDirection || pacman.direction;

    // Choose correct sprite (winged or normal)
    const sprite = hasKey
        ? IKARUS_WINGED_SPRITES[dir]
        : IKARUS_SPRITES[dir];

    if (!sprite) {
        ctx.restore();
        return;
    }

    // Scale to tile size
    const scale = TILE_SIZE / sprite.width;
    ctx.scale(scale, scale);

    // Draw the sprite centered
    ctx.translate(-sprite.width / 2, -sprite.height / 2);
    drawPixelSprite(ctx, sprite, 1);

    ctx.restore();
}


/* =========================================================
   End of Block 5.4
   ========================================================= */


/* =========================================================
   BLOCK 5.5 — IKARUS PIXEL SPRITE DRAWING HELPERS
   ========================================================= */

function drawPixelSprite(ctx, sprite, scale) {
    const { pixels, palette, width, height } = sprite;

    ctx.save();
    ctx.scale(scale, scale);

    for (let y = 0; y < height; y++) {
        const row = pixels[y];
        for (let x = 0; x < width; x++) {
            const colorIndex = row[x];
            if (colorIndex === 0) continue; // transparent

            ctx.fillStyle = palette[colorIndex];
            ctx.fillRect(x, y, 1, 1);
        }
    }

    ctx.restore();
}

/* =========================================================
   End of Block 5.5
   ========================================================= */

/* =========================================================
   End of Block 5
   ========================================================= */



/* =========================================================
   BLOCK 6 — GHOSTS (AI + UPDATE + DRAW) — MVP8
   ========================================================= */

// --- GHOST TARGETING (GLOBAL) ---

function targetPacman() {
    return { x: pacman.worldCol, y: pacman.worldRow };
}

// --- PERSONALITY TARGET FUNCTIONS (GLOBAL) ---

function targetAmbush() {
    const d = DIRS[pacman.direction];
    let x = pacman.worldCol + d.x * 3;
    let y = pacman.worldRow + d.y * 3;

    x = Math.max(0, Math.min(WORLD.width  - 1, x));
    y = Math.max(0, Math.min(WORLD.height - 1, y));

    if (isWall(x, y)) {
        return { x: pacman.worldCol, y: pacman.worldRow };
    }

    return { x, y };
}

function targetRandom() {
    return {
        x: Math.floor(Math.random() * WORLD.width),
        y: Math.floor(Math.random() * WORLD.height)
    };
}

function targetShy() {
    const dist = Math.hypot(
        pacman.worldCol - this.worldCol,
        pacman.worldRow - this.worldRow
    );

    if (dist < 4) {
        return { x: 1, y: WORLD.height - 2 };
    }

    return { x: pacman.worldCol, y: pacman.worldRow };
}

// --- GHOST PATHFINDING (GLOBAL) ---

function getGhostDirection(ghost) {
    const target = ghost.targetFn.call(ghost);
    let bestDir = null;
    let bestScore = -Infinity;
    let validMoves = [];

    for (const dir in DIRS) {
        if (!canMove(ghost, dir)) continue;
        validMoves.push(dir);

        const d = DIRS[dir];
        const nextCol = ghost.worldCol + d.x;
        const nextRow = ghost.worldRow + d.y;

        const dist = Math.hypot(target.x - nextCol, target.y - nextRow);
        let score = -dist;

        const tile = WORLD.map[nextRow][nextCol];
        if (tile === 0) score += 5;
        else if (tile === 2 || tile === 5) score += 1;

        if (isNight) {
            const futureGhost = getCenterPixel(nextCol, nextRow);
            if (isGhostInLanternBeam({ x: futureGhost.x, y: futureGhost.y })) {
                score -= 999;
            }
        }

        if (dir !== oppositeDirection(ghost.direction) && score > bestScore) {
            bestScore = score;
            bestDir = dir;
        }
    }

    if (!bestDir) {
        const nonReverse = validMoves.filter(dir => dir !== oppositeDirection(ghost.direction));
        if (nonReverse.length > 0) {
            return nonReverse[Math.floor(Math.random() * nonReverse.length)];
        }
        return validMoves[Math.floor(Math.random() * validMoves.length)];
    }

    return bestDir;
}

// --- INITIALIZE GHOSTS (GLOBAL COORDS) ---

function initializeGhosts() {
    GHOSTS = GHOST_BEHAVIORS.map((behavior) => {
        const g = {
            name: behavior.name,
            color: behavior.color,

            worldCol: GHOST_START.worldCol,
            worldRow: GHOST_START.worldRow,
            nextCol:  GHOST_START.worldCol,
            nextRow:  GHOST_START.worldRow,

            x: 0,
            y: 0,
            targetX: 0,
            targetY: 0,
            freezeTimer: 0,
            shimmerTimer: Math.random() * 6,
            shimmerSpeed: 1 + Math.random() * 0.5,
            direction: 'LEFT',
            moving: true,
            targetFn: behavior.targetFn
        };

        const { x, y } = getCenterPixel(g.worldCol, g.worldRow);
        g.x = x;
        g.y = y;

        setNextTarget(g, g.direction);
        return g;
    });
}

// --- COLLISION (GLOBAL) ---

function checkGhostCollision() {
    for (const ghost of GHOSTS) {
        if (ghost.name !== "Minotaur") continue;

        const dx = ghost.x - pacman.x;
        const dy = ghost.y - pacman.y;
        const dist = Math.hypot(dx, dy);

        if (dist < TILE_SIZE * 0.5) {
            handlePacmanDeath();
            return;
        }
    }
}

// --- ghost in the lamp beam ---
function isGhostInLanternBeam(ghost) {
    if (!isNight) return false;

    const dx = ghost.x - pacman.x;
    const dy = ghost.y - pacman.y;
    const dist = Math.hypot(dx, dy);

    if (dist > TILE_SIZE * 6) return false;

    let fx = 0, fy = 0;
    const dir = pacman.requestedDirection || pacman.direction;
    if (dir === 'UP')    fy = -1;
    if (dir === 'DOWN')  fy =  1;
    if (dir === 'LEFT')  fx = -1;
    if (dir === 'RIGHT') fx =  1;

    const dot = dx * fx + dy * fy;
    if (dot <= 0) return false;

    const angle = Math.acos(dot / (dist * 1));
    if (angle >= Math.PI / 4) return false;

    const pacCol   = Math.floor(pacman.x / TILE_SIZE);
    const pacRow   = Math.floor(pacman.y / TILE_SIZE);
    const ghostCol = Math.floor(ghost.x / TILE_SIZE);
    const ghostRow = Math.floor(ghost.y / TILE_SIZE);

    return pacRow === ghostRow || pacCol === ghostCol;
}


// --- UPDATE GHOST (GLOBAL) ---

function updateGhost(ghost) {
    const speed = TILE_SIZE * GHOST_SPEED * speedMultiplier* window.globalSlowFactor;

    // --- MINOTAUR CRUSHES BREADCRUMBS ---
    if (ghost.name === "Minotaur") {
        const centerX = ghost.worldCol * TILE_SIZE + TILE_SIZE / 2;
        const centerY = ghost.worldRow * TILE_SIZE + TILE_SIZE / 2;
        const aligned =
            Math.abs(ghost.x - centerX) < 0.5 &&
            Math.abs(ghost.y - centerY) < 0.5;

        if (aligned && WORLD.map[ghost.worldRow][ghost.worldCol] === 0) {
            WORLD.map[ghost.worldRow][ghost.worldCol] = 5; // crushed breadcrumb
        }
    }

    // --- FREEZE LOGIC ---
    if (isNight) {
        if (ghost.freezeTimer > 0) {
            ghost.freezeTimer -= 1 / 60;
            return;
        }

        if (ghost.name !== "Minotaur" && isGhostInLanternBeam(ghost)) {
            ghost.freezeTimer = 0.6;
            return;
        }
    }

    // --- MOVEMENT ---
    const arrived = moveEntity(ghost, speed);

    if (arrived) {
        ghost.direction = getGhostDirection(ghost);
        setNextTarget(ghost, ghost.direction);
    }
}

// --- DRAW GHOST (CAMERA-RELATIVE) ---

function drawGhost(ghost) {
    ctx.save();

    // MVP5 shimmer for non-Minotaurs
    ghost.shimmerTimer += ghost.shimmerSpeed * (1 / 60);
    if (ghost.name !== "Minotaur") {
        const opacity = 0.15 + 0.15 * Math.sin(ghost.shimmerTimer);
        ctx.globalAlpha = opacity;
    } else {
        ctx.globalAlpha = 1.0;
    }

const startRow = Math.floor(CAMERA.row);
const startCol = Math.floor(CAMERA.col);

const screenX = ghost.x - CAMERA.col * TILE_SIZE;
const screenY = ghost.y - CAMERA.row * TILE_SIZE;

    ctx.translate(screenX, screenY);

    if (ghost.danceOffset) {
        ctx.translate(ghost.danceOffset, 0);
    }

    // Night glow
    if (isNight) {
        const dx = ghost.x - pacman.x;
        const dy = ghost.y - pacman.y;
        const dist = Math.hypot(dx, dy);
        const intensity = Math.max(0, 1 - dist * 0.12);
        ctx.shadowColor = ghost.color;
        ctx.shadowBlur = 12 + intensity * 25;
    } else {
        ctx.shadowBlur = 0;
    }

    // Body
    ctx.fillStyle = ghost.color;
    ctx.beginPath();
    ctx.arc(0, 0, TILE_SIZE * 0.35, 0, Math.PI * 2);
    ctx.fill();

    // Eyes
    const eyeOffsetX = TILE_SIZE * 0.12;
    const eyeOffsetY = TILE_SIZE * 0.10;
    const eyeRadius = TILE_SIZE * 0.10;
    const pupilRadius = TILE_SIZE * 0.04;

    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(-eyeOffsetX, -eyeOffsetY, eyeRadius, 0, Math.PI * 2);
    ctx.arc( eyeOffsetX, -eyeOffsetY, eyeRadius, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.arc(-eyeOffsetX, -eyeOffsetY, pupilRadius, 0, Math.PI * 2);
    ctx.arc( eyeOffsetX, -eyeOffsetY, pupilRadius, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
}

/* =========================================================
   End of Block 6 — MVP8
   ========================================================= */


/* =========================================================
   BLOCK 6-PLUS — SMOOTH MOVEMENT + SMOOTH CAMERA (SAFE)
   ========================================================= */

/* ---------------------------------------------------------
   Smooth Pac-Man movement (pixel only)
--------------------------------------------------------- */
function smoothUpdatePacman() {
    // worldRow/worldCol are authoritative integers
    pacman.targetX = pacman.worldCol * TILE_SIZE;
    pacman.targetY = pacman.worldRow * TILE_SIZE;

    // Smooth pixel interpolation
    pacman.x += (pacman.targetX - pacman.x) * 0.35;
    pacman.y += (pacman.targetY - pacman.y) * 0.35;
}

/* ---------------------------------------------------------
   Smooth ghost movement (pixel only)
--------------------------------------------------------- */
function smoothUpdateGhostPosition(ghost) {
    ghost.targetX = ghost.worldCol * TILE_SIZE;
    ghost.targetY = ghost.worldRow * TILE_SIZE;

    ghost.x += (ghost.targetX - ghost.x) * 0.30;
    ghost.y += (ghost.targetY - ghost.y) * 0.30;
}


/* ---------------------------------------------------------
   Combined smoothing pass
--------------------------------------------------------- */
 function smoothMovementUpdate() {
     smoothUpdatePacman();
     for (const ghost of GHOSTS) {
         smoothUpdateGhostPosition(ghost);
     }
     // No smooth camera — camera is snapped in updateCamera()
 }

/* =========================================================
   END of BLOCK 6 plus
   ========================================================= */


/* =========================================================
   BLOCK 7 — COLOR-BASED GHOST PERSONALITIES (MVP8)
   ========================================================= */

function setupNewGameBehaviors() {
    const PERSONALITIES = {
        red:    targetPacman,
        pink:   targetAmbush,
        cyan:   targetRandom,
        orange: targetShy
    };

    const activeColors = [...GHOST_COLORS];

    GHOST_BEHAVIORS = [
        {
            name: "Minotaur",
            color: "red",
            targetFn: targetPacman
        },
        ...activeColors
            .filter(color => color !== "red")
            .map((color, index) => ({
                name: `Ghost ${index + 1}`,
                color,
                targetFn: PERSONALITIES[color]
            }))
    ];
}

/* =========================================================
   End of Block 7
   ========================================================= */


/* =========================================================
   BLOCK 8 — UNIFIED CAMERA SYSTEM (FOLLOW + ROOM)
   ========================================================= */

// Camera modes
const CAMERA_MODE = {
    FOLLOW: 'FOLLOW',
    ROOM: 'ROOM'
};

// Default mode (UI can override later)
let cameraMode = CAMERA_MODE.FOLLOW;

function setCameraMode(mode) {
    cameraMode = mode;

    // Reset fade state so switching modes mid-game is clean
    roomTransitionState = 'NONE';
    roomFade = 0;

    // Snap camera appropriately
    if (cameraMode === CAMERA_MODE.FOLLOW) {
        const pacRow = pacman.y / TILE_SIZE;
        const pacCol = pacman.x / TILE_SIZE;
        CAMERA.row = pacRow - Math.floor(VIEW_HEIGHT / 2);
        CAMERA.col = pacCol - Math.floor(VIEW_WIDTH  / 2);
    } else {
        const { r, c } = getRoomForPacman();
        cameraRoomRow = r;
        cameraRoomCol = c;
        CAMERA.row = r * ROOM_H;
        CAMERA.col = c * ROOM_W;
    }
}

// UI hook
document.getElementById('cameraModeSelect').addEventListener('change', (e) => {
    setCameraMode(CAMERA_MODE[e.target.value]);
});

document.getElementById('exitModeSelect').addEventListener('change', (e) => {
    exitMode = e.target.value;
    rebuildWorldAndRestart();
});

// Room dimensions (for ROOM mode)
const ROOM_H = VIEW_HEIGHT;
const ROOM_W = VIEW_WIDTH;

// Fade transition state machine (ROOM mode only)
let roomTransitionState = 'NONE';   // NONE → FADE_OUT → TELEPORT → FADE_IN
let roomFade = 0;                   // 0 = clear, 1 = black
let roomFadeSpeed = 0.08;

// Current room camera anchor (ROOM mode)
let cameraRoomRow = 0;
let cameraRoomCol = 0;

/* ---------------------------------------------------------
   DETERMINE WHICH ROOM IKARUS IS IN
--------------------------------------------------------- */
function getRoomForPacman() {
    const r = Math.floor(pacman.worldRow / ROOM_H);
    const c = Math.floor(pacman.worldCol / ROOM_W);
    return { r, c };
}

/* ---------------------------------------------------------
   TELEPORT IKARUS (ROOM MODE ONLY)
--------------------------------------------------------- */
function performTeleport() {
    // Wrap-around logic (placeholder — replace with your real portals)
    if (pacman.worldCol < 0) pacman.worldCol = WORLD.width - 1;
    else if (pacman.worldCol >= WORLD.width) pacman.worldCol = 0;

    if (pacman.worldRow < 0) pacman.worldRow = WORLD.height - 1;
    else if (pacman.worldRow >= WORLD.height) pacman.worldRow = 0;

    // Recompute pixel position
    const { x, y } = getCenterPixel(pacman.worldCol, pacman.worldRow);
    pacman.x = x;
    pacman.y = y;

    // Snap camera to new room
    const { r, c } = getRoomForPacman();
    cameraRoomRow = r;
    cameraRoomCol = c;

    CAMERA.row = r * ROOM_H;
    CAMERA.col = c * ROOM_W;
}

/* ---------------------------------------------------------
   UPDATE CAMERA — BOTH MODES
--------------------------------------------------------- */
function updateCamera() {

if (cameraMode === CAMERA_MODE.FOLLOW) {

    // Pac-Man's position in TILE SPACE (fractional)
    const pacRow = pacman.y / TILE_SIZE;
    const pacCol = pacman.x / TILE_SIZE;

    // Desired camera anchor
    let targetRow = pacRow - Math.floor(VIEW_HEIGHT / 2);
    let targetCol = pacCol - Math.floor(VIEW_WIDTH  / 2);

    // Clamp to world bounds
    targetRow = Math.max(0, Math.min(WORLD.height - VIEW_HEIGHT, targetRow));
    targetCol = Math.max(0, Math.min(WORLD.width  - VIEW_WIDTH,  targetCol));

    // Easing factor
    const ease = 0.10;

    // Smoothly approach target (fractional!)
    CAMERA.row += (targetRow - CAMERA.row) * ease;
    CAMERA.col += (targetCol - CAMERA.col) * ease;

    return;
}



    if (cameraMode === CAMERA_MODE.ROOM) {
        // MVP8b — static room camera
        const { r, c } = getRoomForPacman();
        cameraRoomRow = r;
        cameraRoomCol = c;

        CAMERA.row = r * ROOM_H;
        CAMERA.col = c * ROOM_W;
        return;
    }
}

/* ---------------------------------------------------------
   UPDATE LOOP
--------------------------------------------------------- */
function update() {

    /* ------------------------------
       ROOM MODE — FADE STATE MACHINE
       ------------------------------ */
    if (cameraMode === CAMERA_MODE.ROOM) {

        if (roomTransitionState === 'FADE_OUT') {
            roomFade += roomFadeSpeed;
            if (roomFade >= 1) {
                roomFade = 1;
                roomTransitionState = 'TELEPORT';
            }
            return; // freeze gameplay
        }

        if (roomTransitionState === 'TELEPORT') {
            performTeleport();
            updateCamera();   // crucial: snap camera in TELEPORT
            roomTransitionState = 'FADE_IN';
            return;
        }

        if (roomTransitionState === 'FADE_IN') {
            roomFade -= roomFadeSpeed;
            if (roomFade <= 0) {
                roomFade = 0;
                roomTransitionState = 'NONE';
            }
            return; // freeze gameplay
        }
    }

    /* ------------------------------
       NORMAL GAMEPLAY
       ------------------------------ */

    if (window.gameState !== 'RUNNING') return;
    updateSkyIcon();


    if (deathPhase !== 'ALIVE') {
        updateDeathSequence();
        return;
    }

    // Authoritative movement (already pixel-smooth in MVP8)
    updatePacman();
    updateMini();
    GHOSTS.forEach(updateGhost);

    // Doorway detection (ROOM mode only)
    if (cameraMode === CAMERA_MODE.ROOM) {
        const { r, c } = getRoomForPacman();
        if (r !== cameraRoomRow || c !== cameraRoomCol) {
            roomTransitionState = 'FADE_OUT';
            return;
        }
    }

    // FOLLOW mode: camera easing happens inside updateCamera()
    // ROOM mode: camera snapping happens inside updateCamera()
    updateCamera();

    checkGhostCollision();
    updateEndConditions();
}


/* ---------------------------------------------------------
   RENDER LOOP
--------------------------------------------------------- */
function render() {

// Wing moment override
if (performance.now() < window.wingMomentUntil) {
    drawWingPickupMoment();
    return;
}


    // --- VICTORY OVERRIDE ---
    if (window.victoryMode) {
        if (window.endingMode === "TRIO") {
            drawVictoryTrio();
        } else {
            drawVictorySequence();
        }
        return; // <-- legal here
    }

    // Debug text (drawn above everything)
    ctx.fillText(
        `Fade: ${roomFade.toFixed(2)} | State: ${roomTransitionState}`,
        10,
        20
    );

    ctx.save();

    // 1. WORLD
    drawVisibleWorld();

    // 2. TEMPLE FRAME (optional — only if you added it)
    if (typeof drawTempleFrame === "function") {
        drawTempleFrame();
    }

    // 3. SKY ICON (marquee)
    if (skyIcon.active) {
        drawSkyIconSprite(ctx);
    }

    // 4. ACTORS (only when not transitioning)
	if (roomTransitionState === 'NONE' && roomFade === 0) {
	
	    // ⭐ Draw Mini first (behind Pacman)
    	drawMini();
	
    	// Ghosts
    	GHOSTS.forEach(drawGhost);
	
	    // Pacman / Ikarus
	    if (deathPhase !== 'RETURNING') {
	        drawPacman();
	    }
	}

    // 5. DEATH EFFECTS
    drawDeathEffects();

    // 6. FLASH EFFECT
    if (transitionFlash > 0) {
        ctx.fillStyle = `rgba(255,255,255,${transitionFlash})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        transitionFlash -= 0.05;
    }

    // 7. END SCREENS
    if (window.gameState === 'VICTORY') {
        drawEndScreens();
    }
    if (deathPhase === 'RETURNING') {
        drawMessage(getDeathMessage());
    }

    ctx.restore();

    // 8. BLACKOUT CURTAIN (ROOM MODE ONLY)
    if (cameraMode === CAMERA_MODE.ROOM && roomFade > 0) {
        ctx.save();
        ctx.fillStyle = `rgba(0,0,0,${roomFade})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
    }
}




/* ---------------------------------------------------------
   GAME LOOP
--------------------------------------------------------- */
function gameLoop() {
    frameCounter++;
    update();
    render();
    requestAnimationFrame(gameLoop);
}

/* ---------------------------------------------------------
   RESET GAME
--------------------------------------------------------- */
function resetGame() {

    score = 0;
    lives = 3;
    hasKey = false;

    // Pacman start
    pacman.worldCol = 5;
    pacman.worldRow = 11;
    pacman.direction = 'UP';
    pacman.requestedDirection = 'UP';
    pacman.moving = false;        // movement starts AFTER reset
    pacman.isCelebrating = false;

    // Pixel position
    const p = getCenterPixel(pacman.worldCol, pacman.worldRow);
    pacman.x = p.x;
    pacman.y = p.y;

    // Movement vectors
    pacman.nextCol = pacman.worldCol;
    pacman.nextRow = pacman.worldRow;
    setNextTarget(pacman, pacman.direction);

    // Mini start — at exit if available, fallback if not
    let MINI_START_COL, MINI_START_ROW;
    if (exitPos) {
        MINI_START_COL = exitPos.c;
        MINI_START_ROW = exitPos.r;
    } else {
        // Fallback: far from Pacman
        MINI_START_COL = pacman.worldCol + 6;
        MINI_START_ROW = pacman.worldRow + 6;
    }
    initializeMini(MINI_START_COL, MINI_START_ROW);

    setupNewGameBehaviors();

    // Ghosts AFTER Pacman + Mini are fully defined
    initializeGhosts();

    // Camera
    if (cameraMode === CAMERA_MODE.ROOM) {
        const { r, c } = getRoomForPacman();
        cameraRoomRow = r;
        cameraRoomCol = c;

        CAMERA.row = r * ROOM_H;
        CAMERA.col = c * ROOM_W;

    } else {
        CAMERA.col = pacman.worldCol - Math.floor(VIEW_WIDTH / 2);
        CAMERA.row = pacman.worldRow - Math.floor(VIEW_HEIGHT / 2);

        CAMERA.col = Math.max(0, Math.min(CAMERA.col, WORLD.width - VIEW_WIDTH));
        CAMERA.row = Math.max(0, Math.min(CAMERA.row, WORLD.height - VIEW_HEIGHT));
    }

    roomTransitionState = 'NONE';
    roomFade = 0;

    window.gameState = 'RUNNING';
}


/* ---------------------------------------------------------
   END OF BLOCK 8 — UNIFIED CAMERA SYSTEM
   ========================================================= */



/* =========================================================
   BLOCK 9 — DEATH SEQUENCE & SOUL RETURN (ENGINE-SAFE)
   ========================================================= */

/* =========================================================
   BLOCK 9.1 — DEATH SEQUENCE & SOUL RETURN (ENGINE-SAFE, MVP8)
   ========================================================= */

function getDeathMessage() {
    if (typeof lives !== 'number') return "Hmm... something went wrong.";

    if (lives >= 3) return "I'm not done yet!";
    if (lives === 2) return "I'm not done yet!";
    if (lives === 1) return "I'm ... not... done... yet";
    return "...Ok... I'm done";
}

// --- DEATH STATE ---
deathPhase = 'ALIVE'; // ALIVE | DYING | RETURNING | RESPAWNING | CELEBRATION
deathTimer = 0;

let pacmanFade = 1.0;

const DEATH_PAUSE_TIME = 40;   // frames
const SOUL_RETURN_TIME = 120;  // frames

// Soul visual
const soul = {
    x: 0,
    y: 0,
    radius: TILE_SIZE * 0.18
};

// --- PAC-MAN DEATH HANDLER ---
function handlePacmanDeath() {
    pacmanFade = 1.0;
    if (deathPhase !== 'ALIVE') return;

    lives--;
    deathPhase = 'DYING';
    deathTimer = 0;

    pacman.moving = false;

    // Soul starts at Pac-Man's world pixel position
    soul.x = pacman.x;
    soul.y = pacman.y;
}

/* =========================================================
   End of Block 9.1
   ========================================================= */

/* =========================================================
   BLOCK 9.2 — DEATH SEQUENCE UPDATE + DRAWING (MVP8)
   ========================================================= */

function updateDeathSequence() {
    deathTimer++;

    // --- DYING ---
    if (deathPhase === 'DYING') {

        // 1) COLOR SHIMMER
        const shimmer = deathTimer % 20;
        if (shimmer < 7) pacman.color = '#22c55e';
        else if (shimmer < 14) pacman.color = '#3b82f6';
        else pacman.color = '#22c55e';

        // 2) POP FADE
        pacmanFade -= 0.05;
        if (pacmanFade < 0) pacmanFade = 0;

        if (deathTimer >= DEATH_PAUSE_TIME) {
            pacman.color = '#facc15';
            deathPhase = 'RETURNING';
            deathTimer = 0;
        }

        return;
    }

    // --- CELEBRATION (FINAL DEATH) ---
    if (deathPhase === 'CELEBRATION') {

        initializeGhosts();   // prepare chorus
        pacman.isGhost = false;

        deathPhase = 'ALIVE';
        window.gameState = 'GAME_OVER';
        return;
    }

    // --- RETURNING (SOUL FLOATS BACK TO SPAWN) ---
    if (deathPhase === 'RETURNING') {

        // Global spawn point (MVP8)
        const spawn = getCenterPixel(5, 11);

        soul.x += (spawn.x - soul.x) * 0.1;
        soul.y += (spawn.y - soul.y) * 0.1;

        const dx = spawn.x - soul.x;
        const dy = spawn.y - soul.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 1) {

            if (!returningPauseStarted) {
                returningPauseStarted = true;
                returningPauseFrames = 0;
                return;
            }

            returningPauseFrames++;

            if (returningPauseFrames >= 60) {
                if (lives <= 0) {
                    deathPhase = 'CELEBRATION';
                } else {
                    deathPhase = 'RESPAWNING';
                }
                deathTimer = 0;
                returningPauseStarted = false;
                returningPauseFrames = 0;
            }

            return;
        }

        return;
    }

    // --- RESPAWNING ---
    if (deathPhase === 'RESPAWNING') {

        if (lives <= 0) {
            window.gameState = 'GAME_OVER';
            return;
        }

        pacman.isGhost = false;

        // MVP8: world coordinates
        pacman.worldCol = 5;
        pacman.worldRow = 11;
        pacman.direction = 'UP';
        pacman.requestedDirection = 'UP';
        pacman.moving = true;

        const { x, y } = getCenterPixel(pacman.worldCol, pacman.worldRow);
        pacman.x = x;
        pacman.y = y;

        pacman.nextCol = pacman.worldCol;
        pacman.nextRow = pacman.worldRow;

        setNextTarget(pacman, pacman.direction);

        initializeGhosts();
        deathPhase = 'ALIVE';
        return;
    }
}

// --- DRAW DEATH EFFECTS ---
function drawDeathEffects() {
    if (deathPhase === 'RETURNING' && lives > 0) {
        ctx.save();
        ctx.fillStyle = 'rgba(250, 204, 21, 0.85)';
        ctx.shadowColor = '#facc15';
        ctx.shadowBlur = 15;

        ctx.beginPath();
        ctx.arc(soul.x - CAMERA.col * TILE_SIZE,
                soul.y - CAMERA.row * TILE_SIZE,
                soul.radius,
                0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
    }
}

// --- MESSAGE DRAWING ---
function drawMessage(text) {
    ctx.save();

    if (deathPhase === 'CELEBRATION' ||
        window.gameState === 'GAME_OVER' ||
        deathPhase === 'RETURNING') {

        ctx.fillStyle = '#facc15';
        ctx.shadowColor = '#facc15';
        ctx.shadowBlur = 12;

    } else if (lives === 0) {

        ctx.fillStyle = 'rgba(250, 204, 21, 0.4)';
        ctx.shadowColor = 'rgba(250, 204, 21, 0.3)';
        ctx.shadowBlur = 6;

    } else {

        ctx.fillStyle = '#facc15';
        ctx.shadowColor = '#facc15';
        ctx.shadowBlur = 12;
    }

    ctx.font = `${TILE_SIZE * 0.8}px sans-serif`;
    ctx.textAlign = 'center';

    ctx.fillText(
        text,
        canvas.width / 2,
        canvas.height * 0.75
    );

    ctx.restore();
}

/* =========================================================
   End of Block 9.2
   ========================================================= */

/* =========================================================
   End of Block 9
   ========================================================= */


/* =========================================================
   BLOCK 10 — VICTORY & GAME OVER (ENGINE-SAFE, MVP8)
   ========================================================= */

// Victory is now triggered ONLY by reaching the exit with the key.
// No pellet-based victory in MVP8.

function drawEndScreens() {
    if (window.gameState === 'VICTORY') {
        drawOverlay("YOU WIN 🎉");
    }

    if (window.gameState === 'GAME_OVER') {
        drawOverlay("One of us, One of us!");
    }
}

// --- UPDATE HOOK ---
function updateEndConditions() {
    if (deathPhase !== 'ALIVE') return;

    // MVP8: No pellet victory check.
    // Exit victory handled in updatePacman().
}

// --- DRAW END SCREENS (initial boot-time check) ---
if (window.gameState === 'VICTORY') {
    drawOverlay("YOU WIN 🎉");
}

if (window.gameState === 'GAME_OVER') {
    drawOverlay("... ok I'm done ... for now");
}

function drawOverlay(text) {
    ctx.save();
    // ctx.fillStyle = 'rgba(0,0,0,0.7)';
    // ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#fff';
    ctx.font = `${TILE_SIZE * 1.2}px sans-serif`;
    ctx.textAlign = 'center';

    ctx.fillText(
        text,
        canvas.width / 2,
        canvas.height / 2
    );

    ctx.restore();
}

/* =========================================================
   End of Block 10
   ========================================================= */

/* =========================================================
   BLOCK 11 — DAY / NIGHT MODE (SAFE — MVP8)
   ========================================================= */

function updateSkyIcon() {
    if (!skyIcon.active) return;

    const now = performance.now();
    const t = (now - skyIcon.startTime) / skyIcon.duration;

    // Move from left to right across the whole screen
    const startX = -TILE_SIZE * 2;
    const endX = canvas.width + TILE_SIZE * 2;

    skyIcon.x = lerp(startX, endX, t);

    // When finished, deactivate until next cycle
    if (t >= 1) {
        skyIcon.active = false;
    }
}



isNight = false;

// durations in ms
const DAY_TIME = 12000;   // you had 120009999 — assuming typo
const NIGHT_TIME = 8000;

// preserve originals
const DAY_WALL_COLOR = wallColor;
const DAY_SPEED = 1.0;

// Trigger initial sun scroll (screen-relative)
skyIcon.active = true;
skyIcon.sprite = "sun";
skyIcon.x = -TILE_SIZE * 2;
skyIcon.duration = DAY_TIME;
skyIcon.startTime = performance.now();

function enterNight() {
    if (isNight) return;

    transitionFlash = 1.0;

    skyIcon.active = true;
    skyIcon.sprite = "moon";
    skyIcon.x = -TILE_SIZE * 2;
    skyIcon.duration = NIGHT_TIME;
    skyIcon.startTime = performance.now();

    isNight = true;
    wallColor = '#C00000';
    speedMultiplier = 1.08;

    GHOSTS.forEach(g => {
        if (g.name === 'Minotaur') return;

        if (typeof g.targetFn !== 'function') {
            g.targetFn = targetPacman;
        }

        g._dayTarget = g.targetFn;
        g.targetFn = targetPacman;
    });
}

function enterDay() {
    if (!isNight) return;

    transitionFlash = 1.0;

    skyIcon.active = true;
    skyIcon.sprite = "sun";
    skyIcon.x = -TILE_SIZE * 2;
    skyIcon.duration = DAY_TIME;
    skyIcon.startTime = performance.now();

    isNight = false;
    wallColor = DAY_WALL_COLOR;
    speedMultiplier = DAY_SPEED;

    GHOSTS.forEach(g => {
        if (g.name === 'Minotaur') return;

        if (typeof g._dayTarget === 'function') {
            g.targetFn = g._dayTarget;
        }
    });
}

// cycle controller
function cycleDayNight() {
    if (window.gameState === 'GAME_OVER' || window.gameState === 'VICTORY') return;

    if (isNight) {
        enterDay();
        setTimeout(cycleDayNight, DAY_TIME);
    } else {
        enterNight();
        setTimeout(cycleDayNight, NIGHT_TIME);
    }
}

setTimeout(cycleDayNight, DAY_TIME);

/* =========================================================
   End of Block 11
   ========================================================= */


/* =========================================================
   BLOCK 12 — PIXEL SPRITE SYSTEM (NEW)
   ========================================================= */

/*
   drawPixelSprite(ctx, sprite, scale)
   -----------------------------------
   Draws a pixel-matrix sprite at the current ctx origin.
   - sprite.width, sprite.height
   - sprite.palette: { index: "#RRGGBB" or "transparent" }
   - sprite.pixels: 2D array of palette indices
*/

function drawPixelSprite(ctx, sprite, scale = 1) {
    const w = sprite.width;
    const h = sprite.height;
    const px = scale; // pixel size on canvas

    for (let r = 0; r < h; r++) {
        for (let c = 0; c < w; c++) {
            const colorIndex = sprite.pixels[r][c];
            const color = sprite.palette[colorIndex];

            if (!color || color === "transparent") continue;

            ctx.fillStyle = color;
            ctx.fillRect(c * px, r * px, px, px);
        }
    }
}

/* =========================================================
   End of BLOCK 12 
   ========================================================= */

/* =========================================================
   BLOCK 13 A — SKY ICON SPRITES (ARTEMIS)
   ========================================================= */

const ARTEMIS_SPRITE = {
    width: 42,
    height: 42,
    palette: {
        0: "transparent",
        1: "#BFBFBF", // Silver hair
        2: "#F6C6AD", // Skin
        3: "#0B76A0", // Accessories
        4: "#0E2841", // Cape
        5: "#FFC000"  // Gold
    },
    pixels: [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,3,3,3,3,3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,3,3,3,1,1,3,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,1,1,1,1,1,1,3,3,3,1,1,1,1,1,1,1,0,0,0,0,0,0,0,4,0,1,1,1,1,1,1,0,0,0],
        [0,0,0,0,0,0,0,0,1,1,3,3,3,3,3,1,1,2,2,2,2,2,2,0,0,0,0,0,0,0,0,4,0,0,0,1,1,1,1,1,0,0],
        [0,0,0,0,0,0,0,0,3,3,3,3,1,1,1,2,2,2,2,2,4,2,2,0,0,0,0,0,0,0,4,4,0,0,0,0,1,1,1,1,1,0],
        [0,0,0,0,0,0,0,0,3,1,1,1,2,2,1,2,2,2,2,2,4,2,2,2,0,0,0,0,0,4,4,0,0,0,0,0,0,1,1,1,1,0],
        [0,0,0,0,0,0,0,1,1,1,1,1,2,2,1,2,2,2,2,2,2,2,2,2,0,0,0,0,0,4,0,0,0,0,0,0,0,1,1,1,1,1],
        [0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,0,0,0,0,0,4,4,0,0,0,0,0,0,0,1,1,1,1,1],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,1,4,2,2,2,2,2,2,2,0,1,0,0,0,0,4,0,0,0,0,0,0,0,0,1,1,1,1,1],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,4,4,2,2,2,2,0,0,0,1,1,1,0,0,2,4,4,0,0,0,0,0,0,0,1,1,1,1,1],
        [0,0,0,0,1,1,1,1,1,1,1,1,4,2,2,4,1,1,1,4,2,0,0,3,2,2,2,2,4,4,0,0,0,0,0,0,1,1,1,1,1,0],
        [0,0,0,1,1,1,1,4,1,1,4,4,2,2,2,2,4,1,1,1,2,2,2,3,2,2,2,2,2,4,4,0,0,0,0,0,1,1,1,1,1,0],
        [0,0,1,1,1,1,4,4,3,4,4,4,2,2,2,2,2,1,1,1,1,2,2,3,2,2,2,2,0,0,4,0,0,0,0,1,1,1,1,1,0,0],
        [0,0,0,0,1,1,1,3,4,3,4,4,2,2,2,2,2,2,1,1,1,0,0,3,0,0,0,0,0,0,4,0,1,1,1,1,1,1,1,0,0,0],
        [0,0,0,0,1,4,4,4,3,3,3,4,4,1,1,2,2,2,2,2,4,4,0,3,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,4,4,4,4,4,3,3,3,4,1,1,2,2,2,2,2,2,2,2,2,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],
        [0,0,4,4,4,4,1,4,4,4,3,3,3,1,1,1,4,4,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,1,4,4,4,4,4,4,4,4,3,3,3,4,4,4,1,1,1,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,1,4,4,4,1,1,3,3,3,1,1,1,1,1,1,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,1,1,4,4,4,1,4,4,1,1,1,3,4,1,1,1,1,1,1,1,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,1,1,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,4,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,4,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,4,4,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,1,4,4,4,4,4,4,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,4,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,4,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,1,4,4,1,4,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ]
};

/* =========================================================
   End of BLOCK 13 A 
   ========================================================= */

/* =========================================================
   BLOCK 13B — SKY ICON SPRITES (APOLLO)
   ========================================================= */

const APOLLO_SPRITE = {
    width: 42,
    height: 42,
    palette: {
        0: "transparent",
        1: "#E97132", // Hair & Wheels
        2: "#FBE3D6", // Skin
        3: "#C00000", // Red Details
        4: "#FFC000", // Gold Chariot
        5: "#BFBFBF"  // Silver (unused)
    },
    pixels: [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,4,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,0,1,1,0,1,4,0,0],
        [0,0,0,1,1,1,1,1,1,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,1,1,1,1,1,4,0,0],
        [0,0,0,1,1,1,1,2,1,2,2,2,2,2,2,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,1,4,4,4,4,4,1,1,0,0,0],
        [0,0,0,1,1,1,1,2,1,2,2,2,3,2,3,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,1,1,4,4,4,4,4,4,4,0,0,0],
        [0,0,0,0,1,1,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,4,4,4,0,0,0,0,1,4,4,4,4,4,4,4,4,4,0,0],
        [0,0,0,0,1,1,2,2,2,2,2,4,2,2,2,2,0,0,0,0,0,0,4,4,4,4,4,4,0,1,1,4,4,4,4,4,4,4,4,4,0,0],
        [0,0,0,0,0,0,0,2,2,2,2,2,4,4,4,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,1,4,4,4,4,4,4,3,4,3,0,0],
        [0,0,0,0,0,0,1,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,1,4,4,4,4,4,4,4,4,4,4,0],
        [0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,2,2,2,0,0,0,0,0,4,4,4,4,4,4,1,1,4,1,1,4,4,4,4,4,4,3,4],
        [0,0,0,0,0,0,1,1,2,2,2,2,2,1,1,1,2,2,1,1,0,0,0,0,0,4,4,4,4,4,1,4,4,1,4,4,4,4,4,4,4,4],
        [0,0,0,0,0,0,1,1,2,2,2,2,2,1,1,1,2,1,0,0,1,1,1,0,0,0,4,4,4,1,1,4,4,4,4,1,1,0,4,4,4,0],
        [0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,1,1,0,4,4,4,1,1,4,4,4,4,1,1,0,0,0,0,0],
        [0,0,0,0,3,1,1,1,1,1,4,4,4,4,4,4,4,4,3,3,1,1,1,1,4,4,4,4,4,1,4,1,4,4,4,4,1,0,0,0,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,3,0,0,0,1,1,1,1,4,4,4,1,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,3,0,0,1,1,1,4,4,1,1,1,1,4,4,4,4,1,1,1,0,0,0,0,0],
        [0,0,1,1,1,1,3,3,3,1,1,1,1,4,4,4,4,4,3,0,0,1,0,0,4,4,4,4,4,1,4,4,4,4,4,4,1,1,0,0,0,0],
        [0,1,1,1,1,3,4,4,3,1,1,1,1,4,4,4,4,3,3,0,0,0,0,0,4,4,4,4,4,1,4,4,4,4,4,4,1,4,4,0,0,0],
        [0,1,1,1,3,4,4,4,4,3,1,1,1,4,4,4,3,3,0,0,1,0,0,0,4,4,4,1,1,4,0,4,4,4,4,0,0,4,4,0,0,0],
        [0,1,1,1,3,3,4,4,3,1,1,1,1,4,3,3,3,0,1,1,1,0,0,0,4,4,0,4,4,4,0,0,0,4,0,0,0,3,3,3,0,0],
        [0,1,1,1,1,3,3,3,1,1,1,1,1,3,3,0,0,0,1,1,4,4,0,0,4,4,0,0,3,3,0,0,0,4,0,0,0,3,3,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,4,4,0,0,3,3,0,0,3,3,0,0,0,4,3,3,0,0,0,0,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ]
};


/* =========================================================
   End of BLOCK 13 B 
   ========================================================= */
/* =========================================================
   End of BLOCK 13
   ========================================================= */


// DEBUG: Validate sprite matrix dimensions
function debugCheckSprite(sprite, name) {
    console.log(`Checking ${name}...`);
    console.log("Rows:", sprite.pixels.length);

    for (let i = 0; i < sprite.pixels.length; i++) {
        console.log(`Row ${i}: length = ${sprite.pixels[i].length}`);
    }
}

// Run checks
debugCheckSprite(ARTEMIS_SPRITE, "Artemis");
debugCheckSprite(APOLLO_SPRITE, "Apollo");




/* =========================================================
   BLOCK 14 — SKY ICON SPRITE RENDERER (UPDATED)
   ========================================================= */

function drawSkyIconSprite(ctx) {
    const scale = TILE_SIZE * 0.5 * 1.5;

    ctx.save();
    const topOffset = TILE_SIZE * 0.4;
    ctx.translate(skyIcon.x, topOffset);

    if (skyIcon.sprite === "moon") {
        drawPixelSprite(ctx, ARTEMIS_SPRITE, scale / ARTEMIS_SPRITE.width);
    }

    if (skyIcon.sprite === "sun") {
        drawPixelSprite(ctx, APOLLO_SPRITE, scale / APOLLO_SPRITE.width);
    }

    ctx.restore();
}


/* =========================================================
   End of BLOCK 14 
   ========================================================= */


/* =========================================================
   BLOCK 15B — TRIO ENDING (DAWN + TRIO PORTRAIT)
   ========================================================= */

// ---------------------------------------------------------
// 1. ENDING MODE SWITCH
// ---------------------------------------------------------
window.endingMode = "TRIO"; 
// Options: "CLASSIC" (existing), "TRIO" (new ending)


// ---------------------------------------------------------
// 2. TRIO SPRITES (ARTEMIS, APOLLO, IKARUS)
// Palettes chosen by Copilot (harmonized mythic tones)
// ---------------------------------------------------------

const END_ARTEMIS_SPRITE = {
    width: 42,
    height: 42,
    palette: {
        0: "transparent",
        1: "#E8F1FF", // bluish white (moonlit glow)
        2: "#C9D3DD", // silver
        3: "#1A1A1A", // black
        4: "#F4DCCB", // cream skin
        5: "#8A5A3C"  // leather
    },
    pixels: [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,3,3,1,1,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,3,3,1,1,3,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,1,1,1,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,3,0,0,0,3,3,3,3,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,2,2,2,2,2,2,2,2,2,3,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,1,1,4,4,1,1,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,4,4,4,4,4,4,4,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,4,2,2,4,3,2,4,4,4,2,3,4,2,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,2,2,4,2,2,4,1,1,4,4,4,1,1,4,2,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,2,2,2,4,2,2,4,4,4,4,1,4,4,4,4,2,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,1,2,2,2,2,2,2,2,4,4,4,4,1,4,4,4,4,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,3,2,1,1,2,2,2,2,4,4,1,4,4,4,1,4,4,2,2,2,0,2,1,2,2,2,2,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,3,1,3,2,2,2,2,2,4,4,1,1,1,4,4,2,2,2,2,0,0,1,2,2,2,2,2,2,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,2,3,2,3,0,2,2,2,4,4,4,4,4,4,2,2,2,2,0,0,0,1,0,0,2,2,2,2,2,0,0,0,0],
[0,0,0,0,0,0,0,2,2,2,2,3,5,5,5,2,2,2,4,4,2,4,2,2,2,2,0,0,0,0,1,0,0,0,0,2,2,2,2,0,0,0],
[0,0,0,0,0,0,0,2,2,2,0,5,5,5,5,5,2,2,3,4,0,4,3,2,2,0,0,0,0,0,1,0,0,0,0,2,2,2,2,0,0,0],
[0,0,0,0,0,0,2,2,2,2,2,4,4,4,5,1,1,1,3,4,1,4,3,1,1,1,4,4,4,4,1,0,0,0,0,0,2,2,2,2,0,0],
[0,0,0,0,0,2,2,2,2,2,3,4,4,4,1,5,1,1,4,3,3,3,4,1,1,1,1,4,4,4,1,0,0,0,0,0,4,4,2,2,0,0],
[0,0,0,0,2,2,2,3,2,2,3,4,4,4,1,1,5,1,4,4,3,4,4,1,1,1,1,4,4,4,1,4,0,0,4,4,4,2,2,4,4,0],
[0,0,0,0,2,3,3,2,2,3,3,4,4,4,1,1,1,5,1,4,4,4,1,1,1,1,1,3,4,4,1,4,4,0,4,4,4,2,4,4,4,0],
[0,0,0,0,0,2,2,2,2,3,3,4,4,4,1,1,1,1,5,1,4,1,1,1,1,1,1,3,3,4,1,4,4,4,4,4,4,2,4,4,4,0],
[0,0,0,0,2,2,3,2,3,3,3,4,4,3,3,1,1,1,1,5,5,1,1,1,1,1,3,3,3,3,1,4,4,4,4,4,2,2,2,4,4,0],
[0,0,0,0,2,3,2,2,3,3,3,4,4,3,3,3,1,1,1,1,1,5,1,1,1,3,3,3,3,3,1,3,4,4,4,0,2,2,2,2,0,0],
[0,0,0,0,0,2,2,2,3,3,3,4,4,3,3,3,1,1,1,1,1,1,5,1,1,3,3,3,3,3,1,3,0,4,0,0,2,2,2,2,0,0],
[0,0,0,0,2,2,2,3,3,3,3,4,4,3,3,3,3,3,3,3,3,3,3,5,3,5,3,3,3,3,1,3,0,0,0,2,2,2,2,0,0,0],
[0,0,0,2,2,3,3,2,3,3,3,4,4,3,3,3,1,1,1,1,1,1,1,1,5,5,5,0,3,3,1,3,0,0,2,2,2,2,2,0,0,0],
[0,0,0,2,3,3,2,3,3,3,3,4,4,0,3,3,1,1,1,1,1,1,1,1,1,5,5,5,3,3,1,2,2,2,2,2,2,0,0,0,0,0],
[0,0,0,0,3,2,2,3,3,3,3,4,4,4,3,3,1,1,1,1,1,1,1,1,1,1,5,5,2,2,1,2,2,2,2,2,0,0,0,0,0,0],
[0,0,0,0,2,2,3,3,3,3,3,4,4,3,3,1,1,1,1,1,1,1,1,1,1,1,5,5,3,3,3,3,3,0,0,0,0,0,0,0,0,0],
[0,0,0,0,2,3,3,3,3,3,3,4,4,3,3,1,1,1,1,1,1,1,1,1,1,1,5,5,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,3,3,2,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0],
[0,0,3,3,3,2,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,3,3,3,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0]
]
};

const END_APOLLO_SPRITE = {
    width: 26,
    height: 40,
    palette: {
        0: "transparent",
        1: "#D86A1C", // dark orange
        2: "#C00000", // intense red
        3: "#6B3E1E", // brown
        4: "#D0D0D0", // silver
        5: "#1A1A1A", // black
        6: "#F6D8C8", // cream skin
        7: "#FFC000", // gold
        8: "#FFF4C2"  // white/yellow glow
    },
    pixels:[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,1,1,2,1,1,1,1,2,2,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,1,1,1,2,1,1,2,1,1,1,1,1,1,1,0,0,0,0,0,0],
[0,0,0,0,1,1,1,1,1,2,1,1,1,1,2,2,1,1,2,1,1,1,0,0,0,0],
[0,0,0,0,1,1,2,2,1,1,2,1,1,1,1,3,1,1,2,1,1,1,0,0,0,0],
[0,0,0,1,1,1,1,1,1,1,1,1,2,2,1,1,1,2,1,2,2,1,1,0,0,0],
[0,0,0,1,1,2,2,1,1,2,2,1,1,1,1,1,1,2,1,1,1,1,1,0,0,0],
[0,0,0,1,1,1,1,3,5,5,5,6,6,1,1,2,5,1,3,1,2,1,1,0,0,0],
[0,0,0,1,2,1,1,6,6,6,6,6,6,6,1,1,2,1,3,1,1,2,1,0,0,0],
[0,0,0,1,2,6,1,6,6,5,3,6,6,6,6,5,3,2,1,3,6,1,2,0,0,0],
[0,0,0,1,1,6,1,6,6,5,5,6,6,6,6,5,5,6,3,1,6,1,1,0,0,0],
[0,0,0,3,1,6,3,6,6,6,6,6,3,6,6,6,6,6,6,3,6,1,3,0,0,0],
[0,0,0,0,1,2,1,6,6,6,6,6,3,3,6,6,6,6,6,1,2,1,0,0,0,0],
[0,0,0,0,1,3,1,6,6,5,5,6,6,6,6,5,6,6,6,1,3,1,0,0,0,0],
[0,0,0,0,1,3,1,1,6,6,5,5,5,5,5,6,6,6,1,1,3,1,0,0,0,0],
[0,0,0,0,0,0,0,6,3,3,7,3,3,3,3,3,7,3,6,0,0,0,0,0,0,0],
[0,0,0,0,0,0,6,6,3,3,3,7,3,7,3,7,3,3,6,6,0,0,0,0,0,0],
[0,0,0,0,0,6,3,6,6,3,3,3,7,7,7,3,3,6,6,3,6,0,0,0,0,0],
[0,0,0,0,0,6,6,6,3,3,7,7,7,4,7,7,7,3,6,6,6,0,0,0,0,0],
[8,0,0,0,8,8,8,3,3,3,3,3,1,1,3,3,3,3,3,8,8,8,0,0,0,8],
[8,8,8,8,8,8,8,3,3,3,7,1,1,1,1,7,3,3,3,8,8,8,8,8,8,8],
[8,8,8,8,8,8,8,8,3,3,7,7,7,7,7,7,3,3,8,8,8,8,8,8,8,8],
[0,0,8,8,8,8,8,8,8,0,2,7,7,7,7,2,0,8,8,8,8,8,8,8,0,0],
[0,0,0,8,8,0,0,8,8,8,2,2,7,7,2,2,8,8,8,0,0,8,8,0,0,0],
[0,0,0,0,0,0,0,0,8,8,7,7,7,7,7,7,8,8,0,0,0,0,0,0,0,0],
[0,0,0,0,1,1,0,2,8,8,1,7,7,7,7,1,8,8,2,0,1,1,0,0,0,0],
[0,0,0,0,1,1,0,2,8,8,1,7,2,2,7,1,8,8,2,0,1,1,0,0,0,0],
[0,0,0,0,1,1,0,2,7,7,1,7,7,7,7,1,7,7,2,0,1,1,0,0,0,0],
[0,0,0,2,1,1,2,2,7,1,1,1,2,2,1,1,1,7,2,2,1,1,2,0,0,0],
[0,0,0,2,1,1,2,2,1,1,7,1,7,7,1,7,1,1,2,2,1,1,2,0,0,0],
[0,0,0,0,1,1,0,2,7,1,7,7,1,1,7,7,1,7,2,0,1,1,0,0,0,0],
[0,0,0,0,1,1,0,0,7,7,1,1,7,7,1,1,7,7,7,0,1,1,0,0,0,0],
[0,0,0,0,1,1,0,0,0,7,7,1,1,1,1,7,7,7,0,0,1,1,0,0,0,0],
[0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,7,7,7,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,7,7,7,0,0,7,7,7,0,0,0,0,0,0,0,0]
]
};

const END_IKARUS_SPRITE = {
    width: 37,
    height: 30,
    palette: {
        0: "transparent",
        1: "#8A5A3C", // leather
        2: "#1A1A1A", // black
        3: "#F6D8C8", // cream skin
        4: "#FFC000", // gold
        5: "#C9D3DD", // silver
        6: "#FFFFFF"  // white
    },
    pixels:[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,4,5,5,5,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,4,5,5,4,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,4,5,5,4,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,6,6,0,0,0,1,1,1,1,1,1,4,5,5,5,1,1,1,1,1,1,0,0,0,6,6,0,0,0,0,0,0],
[0,0,0,0,6,6,6,6,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,6,6,6,6,0,0,0,0,0],
[0,0,0,6,6,6,6,6,6,0,0,1,1,3,2,2,3,3,3,3,2,2,3,1,1,0,0,6,6,6,6,6,6,0,0,0,0],
[0,0,6,6,6,6,6,6,6,6,6,3,1,2,3,3,3,3,3,3,3,3,2,1,3,6,6,6,6,6,6,6,6,6,0,0,0],
[0,0,0,6,6,6,6,6,6,6,6,3,1,3,3,2,1,3,3,3,2,1,3,1,3,6,6,6,6,6,6,6,6,0,0,0,0],
[0,0,0,6,6,6,6,6,6,6,6,3,3,3,3,3,3,2,3,3,3,3,3,3,3,6,6,6,6,6,6,6,6,0,0,0,0],
[0,0,0,0,6,6,6,6,6,6,6,6,6,3,3,3,3,2,2,3,3,3,3,6,6,6,6,6,6,6,6,6,6,0,0,0,0],
[0,0,0,0,0,6,6,6,6,6,6,6,6,3,3,3,2,3,3,2,3,3,3,6,6,6,6,6,6,6,6,6,0,0,0,0,0],
[0,0,0,0,0,6,6,6,6,6,6,6,6,3,3,3,3,2,2,3,3,3,3,6,6,6,6,6,6,6,6,6,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,6,6,6,6,1,1,1,3,3,3,3,1,1,1,6,6,6,6,6,6,6,0,0,0,0,0,0,0],
[0,0,0,0,3,3,3,1,3,3,3,3,3,3,1,4,1,4,1,4,1,1,3,3,3,3,3,3,1,3,3,3,0,0,0,0,0],
[0,0,0,0,0,0,3,1,3,3,3,3,3,3,1,1,4,4,4,1,1,3,3,3,3,3,3,3,1,3,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,6,6,6,6,6,6,1,1,4,4,1,4,4,1,1,1,6,6,6,6,6,6,6,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,6,6,6,6,6,2,2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,6,6,6,6,6,5,6,6,6,6,6,6,6,6,6,5,6,6,6,6,6,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,6,5,6,6,6,6,5,6,6,6,6,6,6,5,6,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]
};


// ---------------------------------------------------------
// 3. ANIMATION STATE MACHINE
// ---------------------------------------------------------

let trioStartTime = null;

const TRIO_PHASE = {
    FLASH: 0,
    REVEAL: 1,
    PULSE: 2,
    GLOW: 3,
    TEXT: 4,
    HOLD: 5
};

let trioPhase = TRIO_PHASE.FLASH;


// ---------------------------------------------------------
// 4. DRAW DAWN BACKGROUND
// ---------------------------------------------------------

function drawDawnGradient(ctx) {
    const g = ctx.createLinearGradient(0, 0, 0, canvas.height);

    g.addColorStop(0.0, "#0A0F2A"); // deep midnight blue
    g.addColorStop(0.4, "#6E4A8E"); // lavender-rose
    g.addColorStop(1.0, "#F7C27A"); // warm peach-gold

    ctx.fillStyle = g;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}


// ---------------------------------------------------------
// 5. DRAW TRIO (SELFIE COMPOSITION)
// ---------------------------------------------------------


function drawTrioSprites(ctx, scale = 1) {
    ctx.save();

    // Screen center
    const cx = canvas.width / 2;
    const cy = canvas.height * 0.45;

    // Fixed offsets (do NOT scale with sprite size)
    const spacing = TILE_SIZE * 3.2;          // horizontal sibling spacing
    const ikarusLift = TILE_SIZE * 4;         // raise Ikarus by one head
    const ikarusShift = -canvas.width * 0.16; // shift whole trio left (tuned)

    // --- ARTEMIS (left) ---
    ctx.save();
    ctx.translate(cx - spacing + ikarusShift, cy);
    ctx.scale(scale, scale);
    drawPixelSprite(ctx, END_ARTEMIS_SPRITE, 1);
    ctx.restore();

    // --- IKARUS (center, lifted + shifted) ---
    ctx.save();
    ctx.translate(cx + ikarusShift, cy - ikarusLift);
    ctx.scale(scale, scale);
    drawPixelSprite(ctx, END_IKARUS_SPRITE, 1);
    ctx.restore();

    // --- APOLLO (right) ---
    ctx.save();
    ctx.translate(cx + spacing + ikarusShift, cy);
    ctx.scale(scale, scale);
    drawPixelSprite(ctx, END_APOLLO_SPRITE, 1);
    ctx.restore();

    ctx.restore();
}


// ---------------------------------------------------------
// 6. DRAW TRIO ENDING (MAIN RENDERER)
// ---------------------------------------------------------

function drawVictoryTrio() {

    if (!trioStartTime) trioStartTime = performance.now();
    const t = performance.now() - trioStartTime;

    // PHASE 0 — FLASH (0–150ms)
    if (t < 150) {
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        return;
    }

    // PHASE 1 — REVEAL (150–200ms)
    if (t < 200) {
        drawDawnGradient(ctx);
        drawTrioSprites(ctx, 4.0);
        return;
    }

// PHASE 2 — HEARTBEAT PULSE (200–900ms)
if (t < 900) {
    drawDawnGradient(ctx);

    const pulseT = (t - 200) / 700;
    const scale = 4.0 + 0.12 * Math.sin(pulseT * Math.PI);

    drawTrioSprites(ctx, scale);
    return;
}


    // PHASE 3 — GLOW BUILD (900–2000ms)
    if (t < 2000) {
        drawDawnGradient(ctx);

        const glow = Math.min(1, (t - 900) / 1100);

        ctx.save();
        ctx.globalAlpha = 0.4 * glow;
        ctx.fillStyle = "#FFDFA0";
        ctx.shadowColor = "#FFDFA0";
        ctx.shadowBlur = 60;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();

        drawTrioSprites(ctx, 4.0);
        return;
    }

    // PHASE 4 — TEXT FADE-IN (2000–3400ms)
    if (t < 3400) {
        drawDawnGradient(ctx);
        drawTrioSprites(ctx, 4.0);

        const textAlpha = Math.min(1, (t - 2000) / 1400);

        ctx.save();
        ctx.globalAlpha = textAlpha;
        ctx.fillStyle = "#FFFFFF";
        ctx.font = `${TILE_SIZE * 0.7}px serif`;
        ctx.textAlign = "center";
        ctx.shadowColor = "#FFDFA0";
        ctx.shadowBlur = 20;

        ctx.fillText(
            "You found your way to us, little one.",
            canvas.width / 2,
            canvas.height * 0.92
        );

        ctx.restore();
        return;
    }

    // PHASE 5 — HOLD (final still)
    drawDawnGradient(ctx);
    drawTrioSprites(ctx, 4.0);

    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.font = `${TILE_SIZE * 0.7}px serif`;
    ctx.textAlign = "center";
    ctx.shadowColor = "#FFDFA0";
    ctx.shadowBlur = 20;

    ctx.fillText(
        "You found your way to us, little one.",
        canvas.width / 2,
        canvas.height * 0.92
    );
    ctx.restore();
}


/* =========================================================
   END OF BLOCK 15B
   ========================================================= */




/* =========================================================
   Final Block - Startup block 
   ========================================================= */

window.addEventListener("load", () => {
    resizeCanvas();
    resetGame();
    pacman.moving = true;   // movement starts AFTER reset
    gameLoop();
});



</script>





