
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Slider: Sky Preview</title>
    <style>
        :root { --bg: #0b0e14; --panel: #161b22; --accent: #2ed573; --sky: #00d4ff; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; touch-action: none; height: 100vh; }
        
        #header { padding: 10px 15px; width: 100%; background: var(--panel); display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; border-bottom: 2px solid #30363d; }
        
        .preview-box { background: rgba(0,0,0,0.3); border: 1px solid #30363d; border-radius: 8px; width: 80px; height: 40px; display: flex; align-items: center; justify-content: center; position: relative; }
        .preview-label { position: absolute; top: -18px; font-size: 10px; color: var(--sky); font-weight: bold; }
        .preview-block { height: 15px; border-radius: 2px; }

        #game-area { 
            position: relative; width: 320px; height: 440px; 
            background: #000; margin-top: 25px; border: 4px solid #30363d; border-radius: 8px; overflow: hidden; 
        }

        .block {
            position: absolute; height: 38px; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            transition: top 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), left 0.1s linear;
            box-sizing: border-box; border: 2px solid rgba(0,0,0,0.2);
        }
        
        .mode-toggle { background: #30363d; padding: 5px; border-radius: 20px; display: flex; gap: 5px; }
        .mode-btn { border: none; background: none; color: #8b949e; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 10px; font-weight: bold; }
        .mode-btn.active { background: var(--accent); color: #000; }
    </style>
</head>
<body>

<div id="header">
    <div style="font-size: 14px;">Score: <span id="score" style="color:var(--accent)">0</span></div>
    
    <div id="next-container" class="preview-box" style="visibility: hidden;">
        <div class="preview-label">NEXT DROP</div>
        <div id="preview-display" class="preview-block"></div>
    </div>

    <div class="mode-toggle">
        <button id="btn-slider" class="mode-btn active" onclick="setMode('slider')">SLIDER</button>
        <button id="btn-falling" class="mode-btn" onclick="setMode('falling')">FALLING</button>
    </div>
</div>

<div id="game-area">
    <div id="grid-container"></div>
</div>

<script>
const gridWidth = 8, gridHeight = 11, cellSize = 40;
let score = 0, blocks = [], gameMode = 'slider', isBusy = false;
let nextBlockData = null;

const colors = ['#ff4757', '#2ed573', '#1e90ff', '#ffa502', '#70a1ff', '#eccc68'];

function setMode(m) {
    gameMode = m;
    document.getElementById('btn-slider').classList.toggle('active', m === 'slider');
    document.getElementById('btn-falling').classList.toggle('active', m === 'falling');
    document.getElementById('next-container').style.visibility = (m === 'falling') ? 'visible' : 'hidden';
    resetGame();
}

function generateNext() {
    nextBlockData = {
        width: Math.floor(Math.random() * 3) + 1,
        color: colors[Math.floor(Math.random() * colors.length)]
    };
    const pDisplay = document.getElementById('preview-display');
    pDisplay.style.width = (nextBlockData.width * 15) + 'px';
    pDisplay.style.backgroundColor = nextBlockData.color;
}

function createBlock(x, y, width, color) {
    return { id: 'b' + Math.random().toString(36).substr(2,9), x, y, width, color: color || colors[Math.floor(Math.random()*colors.length)] };
}

function spawnSkyBlock() {
    const x = Math.floor(Math.random() * (gridWidth - nextBlockData.width));
    blocks.push(createBlock(x, gridHeight - 1, nextBlockData.width, nextBlockData.color));
    generateNext();
}

function initRow(y) {
    let x = 0;
    while (x < gridWidth - 1) {
        let w = Math.floor(Math.random() * 3) + 1;
        if (x + w >= gridWidth) w = gridWidth - x - 1; 
        if (Math.random() > 0.3) blocks.push(createBlock(x, y, w));
        x += w + 1;
    }
}

function draw() {
    const container = document.getElementById('grid-container');
    const ids = new Set(blocks.map(b => b.id));
    blocks.forEach(b => {
        let el = document.getElementById(b.id);
        if (!el) {
            el = document.createElement('div');
            el.id = b.id; el.className = 'block';
            el.onmousedown = (e) => startDrag(e, b);
            el.ontouchstart = (e) => startDrag(e, b);
            container.appendChild(el);
        }
        el.style.width = (b.width * cellSize) + 'px';
        el.style.left = (b.x * cellSize) + 'px';
        el.style.top = ((gridHeight - 1 - b.y) * cellSize) + 'px';
        el.style.backgroundColor = b.color;
    });
    Array.from(container.children).forEach(child => { if (!ids.has(child.id)) child.remove(); });
    document.getElementById('score').innerText = score;
}

let activeBlock = null, startX = 0, originalX = 0;

function startDrag(e, block) {
    if (isBusy) return;
    activeBlock = block;
    startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    originalX = block.x;
    window.onmousemove = drag; window.ontouchmove = drag;
    window.onmouseup = endDrag; window.ontouchend = endDrag;
}

function drag(e) {
    if (!activeBlock) return;
    const currentX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const diff = Math.round((currentX - startX) / cellSize);
    let newX = Math.max(0, Math.min(originalX + diff, gridWidth - activeBlock.width));
    const collision = blocks.find(b => b.y === activeBlock.y && b.id !== activeBlock.id && newX < b.x + b.width && newX + activeBlock.width > b.x);
    if (!collision) { activeBlock.x = newX; draw(); }
}

async function endDrag() {
    window.onmousemove = null; window.ontouchmove = null;
    if (!activeBlock) return;
    activeBlock = null; isBusy = true;
    
    await applyGravity();
    
    if (gameMode === 'slider') {
        blocks.forEach(b => b.y++);
        initRow(0);
    } else {
        spawnSkyBlock();
    }
    
    await applyGravity();
    isBusy = false; draw();
    if (blocks.some(b => b.y >= gridHeight - 1)) { alert("Game Over!"); resetGame(); }
}

async function applyGravity() {
    let changed = true;
    while (changed) {
        changed = false;
        blocks.sort((a, b) => a.y - b.y);
        for (let b of blocks) {
            while (b.y > 0) {
                const below = blocks.find(other => other.id !== b.id && other.y === b.y - 1 && b.x < other.x + other.width && b.x + b.width > other.x);
                if (!below) { b.y--; changed = true; } else break;
            }
        }
        if (changed) { draw(); await new Promise(r => setTimeout(r, 150)); }

        for (let y = 0; y < gridHeight; y++) {
            let rowFill = new Array(gridWidth).fill(false);
            blocks.filter(b => b.y === y).forEach(b => { for (let i = 0; i < b.width; i++) rowFill[b.x + i] = true; });
            if (rowFill.every(f => f)) {
                blocks = blocks.filter(b => b.y !== y);
                blocks.forEach(b => { if (b.y > y) b.y--; });
                score += 100; changed = true;
                draw(); await new Promise(r => setTimeout(r, 150));
            }
        }
    }
}

function resetGame() {
    blocks = []; score = 0;
    generateNext();
    initRow(0); initRow(1); initRow(2);
    draw();
}

resetGame();
</script>


</body>
</html>
